<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
     <title>Apophenia: a library for scientific computing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
     <link rel="stylesheet" href="typical.css" type="text/css" >
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!-- Google is watching. -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-134313-2";
urchinTracker();
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="typical.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<center><table cellpadding=10pt>
<tr> <td><img width=140px src=flake.gif alt="Patterns in static"></td>
<td><table>
    <tr> <td><center><h2><a href="http://apophenia.info">Apophenia</a></h2></center></td></tr>
    <tr><td><div class="qindex"> <a class="qindex" href="outline.html">Outline</a> | <a class="qindex" href="group__all__public.html">Index </a>  |         <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
                <!-- <a class="qindex" href="files.html">File&nbsp;List&nbsp;</a> -->  </div></td></tr></table>
                                  </td></tr></table></center>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('modelsec.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Models </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>See <a class="el" href="gentle.html#gentle_model">apop_model</a> for an overview of the intent and basic use of the <a class="el" href="structapop__model.html">apop_model</a> struct.</p>
<p>This segment goes into greater detail on the use of existing <a class="el" href="structapop__model.html">apop_model</a> objects. If you need to write a new model, see <a class="el" href="modeldetails.html">Writing new models</a>.</p>
<p>The <code>estimate</code> function will estimate the parameters of your model. Just prep the data, select a model, and produce an estimate:</p>
<div class="fragment"><div class="line"><a class="code" href="structapop__data.html">apop_data</a> *data = apop_query_to_data(<span class="stringliteral">&quot;select outcome, in1, in2, in3 from dataset&quot;</span>);</div><div class="line"><a class="code" href="structapop__model.html">apop_model</a> *the_estimate = <a class="code" href="group__all__public.html#gaf78221aa4167b7b52bdd0a26aab8e576">apop_estimate</a>(data, <a class="code" href="group__models.html#ga319b8e3d5025a6fc94829a978273eb8b">apop_probit</a>);</div><div class="line"><a class="code" href="group__all__public.html#gadc1043a5cda856a5d0a5629dd3f9515e">apop_model_print</a>(the_estimate);</div></div><!-- fragment --><p>Along the way to estimating the parameters, most models also find covariance estimates for the parameters, calculate statistics like log likelihood, and so on, which the final print statement will show.</p>
<p>The <code>apop_probit</code> model that ships with Apophenia is unparameterized: <code>apop_probit-&gt;parameters==NULL</code>. The output from the estimation, <code>the_estimate</code>, has the same form as <code>apop_probit</code>, but <code>the_estimate-&gt;parameters</code> has a meaningful value.</p>
<p>Apophenia ships with many well-known models for your immediate use, including probability distributions, such as the <a class="el" href="group__models.html#ga297c2dc8dbdf4ae93fc7e10860400466">apop_normal</a>, <a class="el" href="group__models.html#ga9c67838a4761452cc2c9113557f2a070">apop_poisson</a>, or <a class="el" href="group__models.html#gac11decb2971532ada7d2cd4982848b90">apop_beta</a> models. The data is assumed to have been drawn from a given distribution and the question is only what distributional parameters best fit. For example, given that the data is Normally distributed, find <img class="formulaInl" alt="$\mu$" src="form_77.png"/> and <img class="formulaInl" alt="$\sigma$" src="form_71.png"/> via <code>apop_estimate(your_data, apop_normal)</code>.</p>
<p>There are also linear models like <a class="el" href="group__models.html#ga85524b1deabd5829227888fd91740cc3">apop_ols</a>, <a class="el" href="group__models.html#ga319b8e3d5025a6fc94829a978273eb8b">apop_probit</a>, and <a class="el" href="group__models.html#gaa88a402cf7d02c25c4613a74ace1b0c1">apop_logit</a>. As in the example, they are on equal footing with the distributions, so nothing keeps you from making random draws from an estimated linear model.</p>
<ul>
<li>If you send a data set with the <code>weights</code> vector filled, <a class="el" href="group__models.html#ga85524b1deabd5829227888fd91740cc3">apop_ols</a> estimates Weighted OLS. </li>
<li>If the dependent variable has more than two categories, the <a class="el" href="group__models.html#ga319b8e3d5025a6fc94829a978273eb8b">apop_probit</a> and <a class="el" href="group__models.html#gaa88a402cf7d02c25c4613a74ace1b0c1">apop_logit</a> models estimate a multinomial logit or probit. </li>
<li>There are separate <a class="el" href="group__models.html#ga297c2dc8dbdf4ae93fc7e10860400466">apop_normal</a> and <a class="el" href="group__models.html#ga3a4389e6e2a1a2ea606f89d55ec558d3">apop_multivariate_normal</a> functions because the parameter formats are slightly different: the univariate Normal keeps both <img class="formulaInl" alt="$\mu$" src="form_77.png"/> and <img class="formulaInl" alt="$\sigma$" src="form_71.png"/> in the vector element of the parameters; the multivariate version uses the vector for the vector of means and the matrix for the <img class="formulaInl" alt="$\Sigma$" src="form_0.png"/> matrix. The univariate version is so heavily used that it merits a special-case model.</li>
</ul>
<p>See the <a class="el" href="group__models.html">Models</a> page for a list of models shipped with Apophenia, including popular favorites like <a class="el" href="group__models.html#gac11decb2971532ada7d2cd4982848b90">apop_beta</a>, <a class="el" href="group__models.html#ga20017e88fda3695f093279c8191f48e3">apop_binomial</a>, <a class="el" href="group__models.html#ga1efcbbe0410c89401354c762363a909f">apop_iv</a> (instrumental variables), <a class="el" href="group__models.html#gaded18b6bf8bd63a53f7b72ed5f27fdb5">apop_kernel_density</a>, <a class="el" href="group__models.html#gaf7d01cc4076c9319036a0cce882dac62">apop_loess</a>, <a class="el" href="group__models.html#ga4a917e02f41e9c6a0ad5e084e3ca42d2">apop_lognormal</a>, <a class="el" href="group__models.html#gaca8f3323c57e0223a9f3c0f991c9760e">apop_pmf</a> (see <a class="el" href="histosec.html">Empirical distributions and PMFs (probability mass functions)</a> below), and <a class="el" href="group__models.html#ga9c67838a4761452cc2c9113557f2a070">apop_poisson</a>.</p>
<p>Simulation models seem to not fit this form, but you will see below that if you can write an objective function for the <code>p</code> method of the model, you can use the above tools. Notably, you can estimate parameters via maximum likelihood and then give confidence intervals around those parameters.</p>
<p><em>More estimation output</em></p>
<p>In the <a class="el" href="structapop__model.html">apop_model</a> returned by <a class="el" href="group__all__public.html#gaf78221aa4167b7b52bdd0a26aab8e576">apop_estimate</a>, you will find:</p>
<ul>
<li>The actual parameter estimates are in an <a class="el" href="gentle.html#apop_data">apop_data</a> set at <code>your_model-&gt;parameters</code>. </li>
<li>A pointer to the <a class="el" href="gentle.html#apop_data">apop_data</a> set used for estimation, named <code>data</code>. </li>
<li>Scalar statistics of the model listed in the output model's <code>info</code> group, which may include some hypothesis tests, a list of expected values, log likelihood, AIC, AIC_c, BIC, et cetera. These can be retrieved via a form like <div class="fragment"><div class="line"><a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(your_model-&gt;info, .rowname=<span class="stringliteral">&quot;log likelihood&quot;</span>);</div><div class="line"><span class="comment">//or</span></div><div class="line"><a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(your_model-&gt;info, .rowname=<span class="stringliteral">&quot;AIC&quot;</span>);</div></div><!-- fragment --> If those are not necessary, adding to your model an <a class="el" href="structapop__parts__wanted__settings.html">apop_parts_wanted_settings</a> group with its default values (see below on settings groups) signals to the model that you want only the parameters and to not waste possibly significant CPU time on covariances, expected values, et cetera. See the <a class="el" href="structapop__parts__wanted__settings.html">apop_parts_wanted_settings</a> documentation for examples and further refinements. </li>
<li>In many cases, covariances of the parameters as a page appended to the parameters; retrieve via <div class="fragment"><div class="line"><a class="code" href="structapop__data.html">apop_data</a> *cov = <a class="code" href="group__all__public.html#ga8b83117b7900b3ae639d36459500becd">apop_data_get_page</a>(your_model-&gt;parameters, <span class="stringliteral">&quot;&lt;Covariance&gt;&quot;</span>);</div></div><!-- fragment --> </li>
<li>Typically for regression-type models, the table of expected values (typically including expected value, actual value, and residual) is a page stapled to the main info page. Retrieve via: <div class="fragment"><div class="line"><a class="code" href="structapop__data.html">apop_data</a> *predict = <a class="code" href="group__all__public.html#ga8b83117b7900b3ae639d36459500becd">apop_data_get_page</a>(your_model-&gt;info, <span class="stringliteral">&quot;&lt;Predicted&gt;&quot;</span>);</div></div><!-- fragment --></li>
</ul>
<p>See individual model documentation for what is provided by any given model.</p>
<p><em>Post-estimation uses</em></p>
<p>But we expect much more from a model than estimating parameters from data.</p>
<p>Continuing the above example where we got an estimated Probit model named <code>the_estimate</code>, we can interrogate the estimate in various familiar ways:</p>
<div class="fragment"><div class="line"><a class="code" href="structapop__data.html">apop_data</a> *expected_value = <a class="code" href="group__all__public.html#gafb6b9006358c4eed4f86a3e7a71029d6">apop_predict</a>(NULL, the_estimate);</div><div class="line"></div><div class="line"><span class="keywordtype">double</span> density_under =  <a class="code" href="group__all__public.html#gaee16258d3e52671e254f3ce03bca7754">apop_cdf</a>(expected_value, the_estimate);</div><div class="line"></div><div class="line"><a class="code" href="structapop__data.html">apop_data</a> *draws = <a class="code" href="group__all__public.html#gaa8d1687ac5d77dfaefe2222b44829cdd">apop_model_draws</a>(the_estimate, .count=1000);</div></div><!-- fragment --><p><a class="el" href="dataones.html">Data format for regression-type models</a></p>
<h1><a class="anchor" id="modelparameterization"></a>
Parameterizing or initializing a model</h1>
<p>The models that ship with Apophenia have the requisite procedures for estimation, making draws, and so on, but have <code>parameters==NULL</code> and <code>settings==NULL</code>. The model is thus, for many purposes, incomplete, and you will need to take some action to complete the model. As per the examples to follow, there are several possibilities:</p>
<ul>
<li>Estimate it! Almost all models can be sent with a data set as an argument to the <code>apop_estimate</code> function. The input model is unchanged, but the output model has parameters and settings in place. </li>
<li>If your model has a fixed number of numeric parameters, then you can set them with apop_model_set_parameters. </li>
<li>If your model has a variable number of parameters, you can directly set the <code>parameters</code> element via apop_data_falloc. For most purposes, you will also need to set the <code>msize1</code>, <code>msize2</code>, <code>vsize</code>, and <code>dsize</code> elements to the size you want. See the example below. </li>
<li>Some models have disparate, non-numeric settings rather than a simple matrix of parameters. For example, an kernel density estimate needs a model as a kernel and a base data set, which can be set via apop_model_set_settings.</li>
</ul>
<p>Here is an example that shows the options for parameterizing a model. After each parameterization, 20 draws are made and written to a file named draws-[modelname].</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;apop.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define print_draws(mm) apop_data_print(apop_model_draws(mm, 20),\</span></div><div class="line"><span class="preprocessor">                                        .output_name= &quot;draws-&quot; #mm);</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(){</div><div class="line">    <a class="code" href="structapop__model.html">apop_model</a> *uniform_20 = apop_model_set_parameters(<a class="code" href="group__models.html#ga95be4cc3931072118a7c8ffece73fbe1">apop_uniform</a>, 0, 20);</div><div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *d = <a class="code" href="group__all__public.html#gaa8d1687ac5d77dfaefe2222b44829cdd">apop_model_draws</a>(uniform_20, 10);</div><div class="line"></div><div class="line">    <span class="comment">//Estimate a Normal distribution from the data:</span></div><div class="line">    <a class="code" href="structapop__model.html">apop_model</a> *N = <a class="code" href="group__all__public.html#gaf78221aa4167b7b52bdd0a26aab8e576">apop_estimate</a>(d, <a class="code" href="group__models.html#ga297c2dc8dbdf4ae93fc7e10860400466">apop_normal</a>);</div><div class="line">    print_draws(N);</div><div class="line"></div><div class="line">    <span class="comment">//estimate a one-dimensional multivariate Normal from the data:</span></div><div class="line">    <a class="code" href="structapop__model.html">apop_model</a> *mvN = <a class="code" href="group__all__public.html#gaf78221aa4167b7b52bdd0a26aab8e576">apop_estimate</a>(d, <a class="code" href="group__models.html#ga3a4389e6e2a1a2ea606f89d55ec558d3">apop_multivariate_normal</a>);</div><div class="line">    print_draws(mvN);</div><div class="line"></div><div class="line">    <span class="comment">//fixed parameter list:</span></div><div class="line">    <a class="code" href="structapop__model.html">apop_model</a> *std_normal = apop_model_set_parameters(<a class="code" href="group__models.html#ga297c2dc8dbdf4ae93fc7e10860400466">apop_normal</a>, 0, 1);</div><div class="line">    print_draws(std_normal);</div><div class="line"></div><div class="line">    <span class="comment">//variable-size parameter list:</span></div><div class="line">    <a class="code" href="structapop__model.html">apop_model</a> *std_multinormal = <a class="code" href="group__all__public.html#ga2d3ad385ec1664415251db974e7505e6">apop_model_copy</a>(<a class="code" href="group__models.html#ga3a4389e6e2a1a2ea606f89d55ec558d3">apop_multivariate_normal</a>);</div><div class="line">    std_multinormal-&gt;msize1 =</div><div class="line">    std_multinormal-&gt;msize2 =</div><div class="line">    std_multinormal-&gt;vsize =</div><div class="line">    std_multinormal-&gt;dsize = 3;</div><div class="line">    std_multinormal-&gt;parameters = apop_data_falloc((3, 3, 3),</div><div class="line">                                1,  1, 0, 0, </div><div class="line">                                1,  0, 1, 0,</div><div class="line">                                1,  0, 0, 1);</div><div class="line">    print_draws(std_multinormal);</div><div class="line"></div><div class="line">    <span class="comment">//estimate a KDE using the defaults:</span></div><div class="line">    <a class="code" href="structapop__model.html">apop_model</a> *k = <a class="code" href="group__all__public.html#gaf78221aa4167b7b52bdd0a26aab8e576">apop_estimate</a>(d, <a class="code" href="group__models.html#gaded18b6bf8bd63a53f7b72ed5f27fdb5">apop_kernel_density</a>);</div><div class="line">    print_draws(k);</div><div class="line"></div><div class="line">    <span class="comment">/*A KDE estimation consists of filling an apop_kernel_density_settings group,</span></div><div class="line"><span class="comment">      so we can set it to use a Normal(μ, 2) kernel via: */</span></div><div class="line">    <a class="code" href="structapop__model.html">apop_model</a> *k2 = apop_model_set_settings(<a class="code" href="group__models.html#gaded18b6bf8bd63a53f7b72ed5f27fdb5">apop_kernel_density</a>,</div><div class="line">                         .base_data=d,</div><div class="line">                         .kernel = apop_model_set_parameters(<a class="code" href="group__models.html#ga297c2dc8dbdf4ae93fc7e10860400466">apop_normal</a>, 0, 2));</div><div class="line">    print_draws(k2);</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="transformsec"></a>
Filtering &amp; updating</h1>
<p>The model structure makes it easy to generate new models that are variants of prior models. Bayesian updating, for example, takes in one <a class="el" href="structapop__model.html">apop_model</a> that we call the prior, one <a class="el" href="structapop__model.html">apop_model</a> that we call a likelihood, and outputs an <a class="el" href="structapop__model.html">apop_model</a> that we call the posterior. One can produce complex models using simpler transformations as well. For example, <a class="el" href="group__all__public.html#ga447a4c4653ee9ea75f926374535fc4a5">apop_model_fix_params</a> will set the free parameters of an input model to a fixed value, thus producing a model with fewer parameters. To transform a Normal( <img class="formulaInl" alt="$\mu$" src="form_77.png"/>, <img class="formulaInl" alt="$\sigma$" src="form_71.png"/>) into a one-parameter Normal( <img class="formulaInl" alt="$\mu$" src="form_77.png"/>, 1):</p>
<div class="fragment"><div class="line"><a class="code" href="structapop__model.html">apop_model</a> *N_sigma1 = <a class="code" href="group__all__public.html#ga447a4c4653ee9ea75f926374535fc4a5">apop_model_fix_params</a>(apop_model_set_parameters(<a class="code" href="group__models.html#ga297c2dc8dbdf4ae93fc7e10860400466">apop_normal</a>, NAN, 1));</div></div><!-- fragment --><p>This can be used anywhere the original Normal distribution can be. To give another example, if we need to truncate the distribution in the data space:</p>
<div class="fragment"><div class="line"><span class="comment">//The constraint function.</span></div><div class="line"><span class="keywordtype">double</span> over_zero(<a class="code" href="structapop__data.html">apop_data</a> *in, <a class="code" href="structapop__model.html">apop_model</a> *m){</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(in) &gt; 0;</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="structapop__model.html">apop_model</a> *trunc = apop_model_dconstrain(.base_model=N_sigma1,</div><div class="line">                                          .constraint=over_zero);</div></div><!-- fragment --><p>Chaining together simpler transformations is an easy method to produce models of arbitrary detail. In the following example:</p>
<ul>
<li>Nature generated data using a mixture of three Poisson distributions, with <img class="formulaInl" alt="$\lambda=2.8$" src="form_113.png"/>, <img class="formulaInl" alt="$2.0$" src="form_114.png"/>, and <img class="formulaInl" alt="$1.3$" src="form_115.png"/>. The resulting model is generated using <a class="el" href="group__all__public.html#ga40bb98b02fde8f8e4ab59a4d127b692f">apop_model_mixture</a>. </li>
<li>Not knowing the true distribution, the analyst models the data with a single Poisson <img class="formulaInl" alt="$(\lambda)$" src="form_116.png"/> distribution with a prior on <img class="formulaInl" alt="$\lambda$" src="form_101.png"/>. The prior selected is a truncated Normal(2, 1), generated by sending the stock <a class="el" href="group__models.html#ga297c2dc8dbdf4ae93fc7e10860400466">apop_normal</a> model to the data-space constraint function <a class="el" href="group__models.html#gaa58cece77dea73979ea15d64ea11b049">apop_dconstrain</a>. </li>
<li>The <a class="el" href="group__all__public.html#ga9c365bd5634e9bf3f2b19a1a61e83c6b">apop_update</a> function takes three arguments: the data set, which comes from draws from the mixture, the prior, and the likelihood. It produces an output model which, in this case, is a PMF describing a distribution over <img class="formulaInl" alt="$\lambda$" src="form_101.png"/>, because a truncated Normal and a Poisson are not conjugate distributions. Knowing that it is a PMF, the <code>-&gt;data</code> element holds a set of draws from the posterior. </li>
<li>The analyst would like to present an approximation to the posterior in a simpler form, and so finds the parameters <img class="formulaInl" alt="$\mu$" src="form_77.png"/> and <img class="formulaInl" alt="$\sigma$" src="form_71.png"/> of the Normal distribution that is closest to that posterior.</li>
</ul>
<p>Here is a program&mdash;almost a single line of code&mdash;that builds the final approximation to the posterior model from the subcomponents, including draws from Nature and the analyst's prior and likelihood:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;apop.h&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// For defining the bounds the data-constraining function</span></div><div class="line"><span class="comment">// needs to enforce.</span></div><div class="line"><span class="keywordtype">double</span> greater_than_zero(<a class="code" href="structapop__data.html">apop_data</a> *d, <a class="code" href="structapop__model.html">apop_model</a> *m){</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(d) &gt; 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(){</div><div class="line">    <a class="code" href="group__all__public.html#gadc1043a5cda856a5d0a5629dd3f9515e">apop_model_print</a> (</div><div class="line">        <a class="code" href="group__all__public.html#gaf78221aa4167b7b52bdd0a26aab8e576">apop_estimate</a>(</div><div class="line">             <a class="code" href="group__all__public.html#ga9c365bd5634e9bf3f2b19a1a61e83c6b">apop_update</a>(</div><div class="line">                <a class="code" href="group__all__public.html#gaa8d1687ac5d77dfaefe2222b44829cdd">apop_model_draws</a>(</div><div class="line">                    <a class="code" href="group__all__public.html#ga40bb98b02fde8f8e4ab59a4d127b692f">apop_model_mixture</a>(</div><div class="line">                        apop_model_set_parameters(<a class="code" href="group__models.html#ga9c67838a4761452cc2c9113557f2a070">apop_poisson</a>, 2.8),</div><div class="line">                        apop_model_set_parameters(<a class="code" href="group__models.html#ga9c67838a4761452cc2c9113557f2a070">apop_poisson</a>, 2.0),</div><div class="line">                        apop_model_set_parameters(<a class="code" href="group__models.html#ga9c67838a4761452cc2c9113557f2a070">apop_poisson</a>, 1.3)</div><div class="line">                    ), </div><div class="line">                    1e4</div><div class="line">                ),</div><div class="line">                apop_model_dconstrain(</div><div class="line">                    .base_model=apop_model_set_parameters(<a class="code" href="group__models.html#ga297c2dc8dbdf4ae93fc7e10860400466">apop_normal</a>, 2, 1), </div><div class="line">                    .constraint=greater_than_zero</div><div class="line">                ),</div><div class="line">                <a class="code" href="group__models.html#ga9c67838a4761452cc2c9113557f2a070">apop_poisson</a></div><div class="line">            )-&gt;data,</div><div class="line">            <a class="code" href="group__models.html#ga297c2dc8dbdf4ae93fc7e10860400466">apop_normal</a></div><div class="line">        )</div><div class="line">    );</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="mathmethods"></a>
Model methods</h1>
<ul>
<li><a class="el" href="group__all__public.html#gaf78221aa4167b7b52bdd0a26aab8e576">apop_estimate</a> : estimate the parameters of the model with data. </li>
<li><a class="el" href="group__all__public.html#gafb6b9006358c4eed4f86a3e7a71029d6">apop_predict</a> : the expected value function. </li>
<li><a class="el" href="group__all__public.html#ga87f15cd1923ed7b5b46e52a77ca1dfef">apop_draw</a> : random draws from an estimated model. </li>
<li><a class="el" href="group__all__public.html#ga2510c7df8ccd834732ee208005738b0f">apop_p</a> : the probability of a given data set given the model. </li>
<li><a class="el" href="group__all__public.html#ga5e160c8d0a0ee660c89fb3f6de2af89c">apop_log_likelihood</a> : the log of <a class="el" href="group__all__public.html#ga2510c7df8ccd834732ee208005738b0f">apop_p</a> </li>
<li><a class="el" href="group__all__public.html#ga228b013bc80f308900882312cab93eb3">apop_score</a> : the derivative of <a class="el" href="group__all__public.html#ga5e160c8d0a0ee660c89fb3f6de2af89c">apop_log_likelihood</a> </li>
<li><a class="el" href="group__all__public.html#gadc1043a5cda856a5d0a5629dd3f9515e">apop_model_print</a> : write model components to the screen or a file </li>
<li><a class="el" href="group__all__public.html#ga2d3ad385ec1664415251db974e7505e6">apop_model_copy</a> : duplicate a model </li>
<li>apop_model_set_parameters : Use this to convert a Normal( <img class="formulaInl" alt="$\mu$" src="form_77.png"/>, <img class="formulaInl" alt="$\sigma$" src="form_71.png"/>) with unknown <img class="formulaInl" alt="$\mu$" src="form_77.png"/> and <img class="formulaInl" alt="$\sigma$" src="form_71.png"/> into a Normal(0, 1), for example. </li>
<li><a class="el" href="group__all__public.html#gab29755a86b82dfe31cdd01d55431cc09">apop_model_free</a> </li>
<li><a class="el" href="group__all__public.html#gabbb17b1fe9430882d36d1829398f68f6">apop_model_clear</a> , <a class="el" href="group__all__public.html#ga373ccc4cb87b162d62d07a2685ccd8ba">apop_prep</a> : remove the parameters from a parameterized model. Used infrequently. </li>
<li><a class="el" href="group__all__public.html#gaa8d1687ac5d77dfaefe2222b44829cdd">apop_model_draws</a> : many random draws from an estimated model.</li>
</ul>
<ul>
<li><a class="el" href="group__all__public.html#ga9c365bd5634e9bf3f2b19a1a61e83c6b">apop_update</a> : Bayesian updating </li>
<li>apop_model_coordinate_transform : apply an invertible transformation to the data space </li>
<li>apop_model_dconstrain : constrain the data space of a model to a subspace. E.g., truncate a Normal distribution so <img class="formulaInl" alt="$x&gt;0$" src="form_117.png"/>. </li>
<li><a class="el" href="group__all__public.html#ga447a4c4653ee9ea75f926374535fc4a5">apop_model_fix_params</a> : hold some parameters constant </li>
<li><a class="el" href="group__all__public.html#ga40bb98b02fde8f8e4ab59a4d127b692f">apop_model_mixture</a> : a linear combination of models </li>
<li><a class="el" href="group__all__public.html#gafbc21644ccf24f498a3b3a7e94758e58">apop_model_cross</a> : If <img class="formulaInl" alt="$(d_1)$" src="form_118.png"/> has a Normal <img class="formulaInl" alt="$(\mu, \sigma)$" src="form_119.png"/> distribution and <img class="formulaInl" alt="$d_2$" src="form_120.png"/> has an independent Poisson <img class="formulaInl" alt="$(\lambda)$" src="form_116.png"/> distribution, then <img class="formulaInl" alt="$(d_1, d_2)$" src="form_121.png"/> has an <code><a class="el" href="group__all__public.html#gafbc21644ccf24f498a3b3a7e94758e58">apop_model_cross(apop_normal, apop_poisson)</a></code> distribution with parameters <img class="formulaInl" alt="$(\mu, \sigma, \lambda)$" src="form_122.png"/>.</li>
</ul>
<h1><a class="anchor" id="modelsettings"></a>
Settings groups</h1>
<p>Describing a statistical, agent-based, social, or physical model in a standardized form is difficult because every model has significantly different settings. An MLE requires a method of search (conjugate gradient, simplex, simulated annealing), and a histogram needs the number of bins to be filled with data.</p>
<p>So, the <a class="el" href="structapop__model.html">apop_model</a> includes a single list which can hold an arbitrary number of settings groups, like the search specifications for finding the maximum likelihood, a histogram for making random draws, and options about the model type.</p>
<p>Settings groups are automatically initialized with default values when needed. If the defaults do no harm, then you don't need to think about these settings groups at all.</p>
<p>Here is an example where a settings group is worth tweaking: the <a class="el" href="structapop__parts__wanted__settings.html">apop_parts_wanted_settings</a> group indicates which parts of the auxiliary data you want.</p>
<div class="fragment"><div class="line">1 <a class="code" href="structapop__model.html">apop_model</a> *m = <a class="code" href="group__all__public.html#ga2d3ad385ec1664415251db974e7505e6">apop_model_copy</a>(<a class="code" href="group__models.html#ga85524b1deabd5829227888fd91740cc3">apop_ols</a>);</div><div class="line">2 <a class="code" href="group__all__public.html#ga8fb1877a3cc29edd685a68dd6b4a35dc">Apop_settings_add_group</a>(m, apop_parts_wanted, .covariance=<span class="charliteral">&#39;y&#39;</span>);</div><div class="line">3 <a class="code" href="structapop__model.html">apop_model</a> *est = <a class="code" href="group__all__public.html#gaf78221aa4167b7b52bdd0a26aab8e576">apop_estimate</a>(data, m);</div></div><!-- fragment --><p>Line one establishes the baseline form of the model. Line two adds a settings group of type <a class="el" href="structapop__parts__wanted__settings.html">apop_parts_wanted_settings</a> to the model. By default other auxiliary items, like the expected values, are set to <code>'n'</code> when using this group, so this specifies that we want covariance and only covariance. Having stated our preferences, line three does the estimation we want.</p>
<p>Notice that the <code>_settings</code> ending to the settings group's name isn't written&mdash;macros make it happen. The remaining arguments to <code>Apop_settings_add_group</code> (if any) follow the <a class="el" href="designated.html">Designated initializers</a> syntax of the form <code>.setting=value</code>.</p>
<p>There is an <a class="el" href="group__all__public.html#ga8e5f7950ae47b299e20f2c447199cf6f">apop_model_copy_set</a> macro that adds a settings group when it is first copied, joining up lines one and two above:</p>
<div class="fragment"><div class="line"><a class="code" href="structapop__model.html">apop_model</a> *m = <a class="code" href="group__all__public.html#ga8e5f7950ae47b299e20f2c447199cf6f">apop_model_copy_set</a>(<a class="code" href="group__models.html#ga85524b1deabd5829227888fd91740cc3">apop_ols</a>, apop_parts_wanted, .covariance=<span class="charliteral">&#39;y&#39;</span>);</div></div><!-- fragment --><p>Settings groups are copied with the model, which facilitates chaining estimations. Continuing the above example, you could re-estimate to get the predicted values and covariance via:</p>
<div class="fragment"><div class="line"><a class="code" href="group__all__public.html#ga8659282b6003f7c2adac6f4baad5fae4">Apop_settings_set</a>(est, apop_parts_wanted, predicted, <span class="charliteral">&#39;y&#39;</span>);</div><div class="line"><a class="code" href="structapop__model.html">apop_model</a> *est2 = <a class="code" href="group__all__public.html#gaf78221aa4167b7b52bdd0a26aab8e576">apop_estimate</a>(data, est);</div></div><!-- fragment --><p>Maximum likelihood search has many settings that could be modified, and so provides another common example of using settings groups:</p>
<div class="fragment"><div class="line"><a class="code" href="structapop__model.html">apop_model</a> *the_estimate = <a class="code" href="group__all__public.html#gaf78221aa4167b7b52bdd0a26aab8e576">apop_estimate</a>(data, <a class="code" href="group__models.html#ga319b8e3d5025a6fc94829a978273eb8b">apop_probit</a>);</div><div class="line"></div><div class="line"><span class="comment">//Redo the Probit&#39;s MLE search using Newton&#39;s Method:</span></div><div class="line"><a class="code" href="group__all__public.html#ga8fb1877a3cc29edd685a68dd6b4a35dc">Apop_settings_add_group</a>(the_estimate, apop_mle, .verbose=<span class="charliteral">&#39;y&#39;</span>, </div><div class="line">                        .tolerance=1e-4, .method=<span class="stringliteral">&quot;Newton&quot;</span>);</div><div class="line"><a class="code" href="structapop__model.html">apop_model</a> *re_est = <a class="code" href="group__all__public.html#gaf78221aa4167b7b52bdd0a26aab8e576">apop_estimate</a>(data, the_estimate);</div></div><!-- fragment --><p>To clarify the distinction between parameters and settings, note that parameters are estimated from the data, often via a maximum likelihood search. In an ML search, the method of search, the number of bins in a histogram, or the number of steps in a simulation would be held fixed as the search iterates over possible parameters (and if these settings do change, then that is a meta-model that could be encapsulated into another <a class="el" href="structapop__model.html">apop_model</a>). As a consequence, parameters are always numeric, while settings may be any type.</p>
<ul>
<li><a class="el" href="group__all__public.html#ga8659282b6003f7c2adac6f4baad5fae4">Apop_settings_set</a>, for modifying a single setting, doesn't use the designated initializers format. </li>
<li>Because the settings groups are buried within the model, debugging them can be a pain. Here is a documented macro for <code>gdb</code> that will help you pull a settings group out of a model for your inspection, to cut and paste into your <code>.gdbinit</code>. It shouldn't be too difficult to modify this macro for other debuggers.</li>
</ul>
<div class="fragment"><div class="line">define get_group</div><div class="line">    <span class="keyword">set</span> $group = ($arg1_settings *) apop_settings_get_grp( $arg0, <span class="stringliteral">&quot;$arg1&quot;</span>, 0 )</div><div class="line">    p *$group</div><div class="line">end</div><div class="line">document get_group </div><div class="line">Gets a settings group from a model.</div><div class="line">Give the model name and the name of the group, like</div><div class="line">get_group my_model apop_mle </div><div class="line">and I will <span class="keyword">set</span> a gdb variable named $group that points to that model, </div><div class="line">which you can use like any other pointer. For example, print the contents with</div><div class="line">p *$group</div><div class="line">The contents of $group are printed to the screen as visible output to <span class="keyword">this</span> macro.</div><div class="line">end </div></div><!-- fragment --><p>For using a model, that's all of what you need to know. For details on writing a new settings group, see <a class="el" href="modeldetails.html#settingswriting">Writing new settings groups</a> .</p>
<ul>
<li><a class="el" href="group__all__public.html#ga8fb1877a3cc29edd685a68dd6b4a35dc">Apop_settings_add_group</a> </li>
<li><a class="el" href="group__all__public.html#ga8659282b6003f7c2adac6f4baad5fae4">Apop_settings_set</a> </li>
<li><a class="el" href="group__all__public.html#ga4ba53402807c9e6b82254fb552029501">Apop_settings_get</a> : get a single element from a settings group. </li>
<li><a class="el" href="group__all__public.html#gaafba071ab93465fed4cac1020082b4c8">Apop_settings_get_group</a> : get the whole settings group. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
</body></html>

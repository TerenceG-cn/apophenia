<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html> <head>
     <title>Apophenia: a library for scientific computing</title>
<!-- Google is watching. -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-134313-2";
urchinTracker();
</script>
     <link rel="stylesheet" href="typical.css" type="text/css" >
     <script  type="text/javascript" language="JavaScript" src="tree.js"></script>
</head><body>
     <center><table cellpadding=10pt>
     <tr> <td><img width=140px src=flake.gif alt="Patterns in static"></td> 
    <td><table>
     	<tr> <td><center><h2><a href="http://apophenia.info">Apophenia</a></h2></center></td></tr>
<tr><td><div class="qindex"><a class="qindex" href="index.html">&nbsp;Intro</a> | <a class="qindex" href="outline.html">Outline</a> | <a class="qindex" href="globals.html">Index</a> <!--| <a class="qindex" href="files.html">File&nbsp;List&nbsp;</a> -->  </div></td></tr></table>
	</td></tr></table></center>
    <div> <!--Doxygen generates an extra </div>.-->
<!-- Generated by Doxygen 1.8.9.1 -->
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">apop_conversions.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structline__parse__t.html">line_parse_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structapop__char__info.html">apop_char_info</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a2ebf400a5c61debc1b29348719cf1bec"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2ebf400a5c61debc1b29348719cf1bec"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DbType</b>&#160;&#160;&#160;apop_opts.db_engine=='m' ? &quot;text&quot; : &quot;character&quot;</td></tr>
<tr class="separator:a2ebf400a5c61debc1b29348719cf1bec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1246181a82eca8de97c760b2d51ed997"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1246181a82eca8de97c760b2d51ed997"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DbType2</b>&#160;&#160;&#160;apop_opts.db_engine=='m' ? &quot;double&quot; : &quot;numeric&quot;</td></tr>
<tr class="separator:a1246181a82eca8de97c760b2d51ed997"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab961ddb0cb535bbba949530d58d7c8d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>Textrealloc</b>(str,  len)</td></tr>
<tr class="separator:aab961ddb0cb535bbba949530d58d7c8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab319c5937e4c2623e2c6d7e0064173db"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab319c5937e4c2623e2c6d7e0064173db"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>xprintf</b> (char **q, char *format,...)</td></tr>
<tr class="separator:ab319c5937e4c2623e2c6d7e0064173db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8abdcdbaceaaf0dd3882a164bc2565de"><td class="memItemLeft" align="right" valign="top">gsl_vector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__conversions.html#ga8abdcdbaceaaf0dd3882a164bc2565de">apop_array_to_vector</a> (double *in, int size)</td></tr>
<tr class="separator:ga8abdcdbaceaaf0dd3882a164bc2565de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga604388dc6d7d08d95bbaa4422085db9c"><td class="memItemLeft" align="right" valign="top">gsl_matrix *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__conversions.html#ga604388dc6d7d08d95bbaa4422085db9c">apop_vector_to_matrix</a> (const gsl_vector *in, char row_col)</td></tr>
<tr class="separator:ga604388dc6d7d08d95bbaa4422085db9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebe17fe6f2b0c49c0c90824b7a68ff90"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__conversions_8c.html#aebe17fe6f2b0c49c0c90824b7a68ff90">apop_db_to_crosstab</a> (char *tabname, char *r1, char *r2, char *datacol)</td></tr>
<tr class="separator:aebe17fe6f2b0c49c0c90824b7a68ff90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee8c299b83b8500b8b6ecd30817353c8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__conversions_8c.html#aee8c299b83b8500b8b6ecd30817353c8">apop_crosstab_to_db</a> (<a class="el" href="structapop__data.html">apop_data</a> *in, char *tabname, char *row_col_name, char *col_col_name, char *data_col_name)</td></tr>
<tr class="separator:aee8c299b83b8500b8b6ecd30817353c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c4bb25171301f09a35c36306a7b9783"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__conversions_8c.html#a8c4bb25171301f09a35c36306a7b9783">apop_data_rank_compress</a> (<a class="el" href="structapop__data.html">apop_data</a> *in)</td></tr>
<tr class="separator:a8c4bb25171301f09a35c36306a7b9783"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2feb17743f8b07b8ddcf457362cabefc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__conversions_8c.html#a2feb17743f8b07b8ddcf457362cabefc">apop_data_rank_expand</a> (<a class="el" href="structapop__data.html">apop_data</a> *in)</td></tr>
<tr class="separator:a2feb17743f8b07b8ddcf457362cabefc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5baf0e8717a30fdcfba350da904c1825"><td class="memItemLeft" align="right" valign="top">gsl_vector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__convenience__fns.html#ga5baf0e8717a30fdcfba350da904c1825">apop_vector_copy</a> (const gsl_vector *in)</td></tr>
<tr class="separator:ga5baf0e8717a30fdcfba350da904c1825"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga45bb322b9f491c46feb1e24025b6301f"><td class="memItemLeft" align="right" valign="top">gsl_matrix *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__convenience__fns.html#ga45bb322b9f491c46feb1e24025b6301f">apop_matrix_copy</a> (const gsl_matrix *in)</td></tr>
<tr class="separator:ga45bb322b9f491c46feb1e24025b6301f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga630de5d4fcbe9ef13373029f5d813a97"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__conversions.html#ga630de5d4fcbe9ef13373029f5d813a97">apop_text_to_data</a> (char const *text_file, int has_row_names, int has_col_names, int const *field_ends, char const *delimiters)</td></tr>
<tr class="separator:ga630de5d4fcbe9ef13373029f5d813a97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae3058b7f39d0442f13284464d1ba235d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__conversions.html#gae3058b7f39d0442f13284464d1ba235d">apop_data_unpack</a> (const gsl_vector *in, <a class="el" href="structapop__data.html">apop_data</a> *d, char use_info_pages)</td></tr>
<tr class="separator:gae3058b7f39d0442f13284464d1ba235d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7e31798ab418cbfc7488eaba27dad2af"><td class="memItemLeft" align="right" valign="top">gsl_vector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__conversions.html#ga7e31798ab418cbfc7488eaba27dad2af">apop_data_pack</a> (const <a class="el" href="structapop__data.html">apop_data</a> *in, gsl_vector *out, char all_pages, char use_info_pages)</td></tr>
<tr class="separator:ga7e31798ab418cbfc7488eaba27dad2af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65a20082f0b120016f673e7d2ad899a8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a65a20082f0b120016f673e7d2ad899a8"></a>
<a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>apop_data_fill_base</b> (<a class="el" href="structapop__data.html">apop_data</a> *in, double ap[])</td></tr>
<tr class="separator:a65a20082f0b120016f673e7d2ad899a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68210ee2c87e9cbb7733a14eb907b6cd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a68210ee2c87e9cbb7733a14eb907b6cd"></a>
gsl_vector *&#160;</td><td class="memItemRight" valign="bottom"><b>apop_vector_fill_base</b> (gsl_vector *in, double ap[])</td></tr>
<tr class="separator:a68210ee2c87e9cbb7733a14eb907b6cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fd20a9fd056845b5469b6d3bb48c653"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1fd20a9fd056845b5469b6d3bb48c653"></a>
<a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>apop_text_fill_base</b> (<a class="el" href="structapop__data.html">apop_data</a> *data, char *text[])</td></tr>
<tr class="separator:a1fd20a9fd056845b5469b6d3bb48c653"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6114b6a2be902c83a75d4367db4371f"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__conversions_8c.html#ac6114b6a2be902c83a75d4367db4371f">prep_string_for_sqlite</a> (int prepped_statements, char const *astring)</td></tr>
<tr class="separator:ac6114b6a2be902c83a75d4367db4371f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ab4476fcb509f5d3cec5524b067ff64"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1ab4476fcb509f5d3cec5524b067ff64"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>apop_use_sqlite_prepared_statements</b> (size_t col_ct)</td></tr>
<tr class="separator:a1ab4476fcb509f5d3cec5524b067ff64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a751a9c56042a73c5a3f8aa3ab0f8a4f7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a751a9c56042a73c5a3f8aa3ab0f8a4f7"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>apop_prepare_prepared_statements</b> (char const *tabname, size_t col_ct, sqlite3_stmt **statement)</td></tr>
<tr class="separator:a751a9c56042a73c5a3f8aa3ab0f8a4f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1eafa62401a8987710670aa52a88bffc"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1eafa62401a8987710670aa52a88bffc"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><b>cut_at_dot</b> (char const *infile)</td></tr>
<tr class="separator:a1eafa62401a8987710670aa52a88bffc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabd00e16791a970631c3ed4ac3487da46"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__conversions.html#gabd00e16791a970631c3ed4ac3487da46">apop_text_to_db</a> (char const *text_file, char *tabname, int has_row_names, int has_col_names, char **field_names, int const *field_ends, <a class="el" href="structapop__data.html">apop_data</a> *field_params, char *table_params, char const *delimiters, char if_table_exists)</td></tr>
<tr class="separator:gabd00e16791a970631c3ed4ac3487da46"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a201b1c20fa5fc477ace17b83e559cc7c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a201b1c20fa5fc477ace17b83e559cc7c"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><b>apop_nul_string</b></td></tr>
<tr class="separator:a201b1c20fa5fc477ace17b83e559cc7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6e663497d2c934364b3bcf07496b30b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad6e663497d2c934364b3bcf07496b30b"></a>
sqlite3 *&#160;</td><td class="memItemRight" valign="bottom"><b>db</b></td></tr>
<tr class="separator:ad6e663497d2c934364b3bcf07496b30b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The various functions to convert from one format to another. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="aab961ddb0cb535bbba949530d58d7c8d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Textrealloc</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">str, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">len&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">(str) =         \</div>
<div class="line">            (str) != apop_nul_string          \</div>
<div class="line">                ? realloc((str), (len))       \</div>
<div class="line">                : (((len) &gt; 0) ? malloc(len) : apop_nul_string);</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aee8c299b83b8500b8b6ecd30817353c8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apop_crosstab_to_db </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td>
          <td class="paramname"><em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>tabname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>row_col_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>col_col_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data_col_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>See <a class="el" href="apop__conversions_8c.html#aebe17fe6f2b0c49c0c90824b7a68ff90">apop_db_to_crosstab</a> for the storyline; this is the complement, which takes a crosstab and writes its values to the database.</p>
<p>For example, I would take </p><table  frame="box">
<tr>
<td></td><td>c0</td><td>c1 </td></tr>
<tr valign="bottom">
<td align="center"></td></tr>
<tr>
<td>r0</td><td>2</td><td>3 </td></tr>
<tr>
<td>r1</td><td>0</td><td>4 </td></tr>
</table>
<p>and do the following writes to the database:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;insert into your_table values (&#39;r0&#39;, &#39;c0&#39;, 2);</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;insert into your_table values (&#39;r0&#39;, &#39;c1&#39;, 3);</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;insert into your_table values (&#39;r1&#39;, &#39;c0&#39;, 3);</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;insert into your_table values (&#39;r1&#39;, &#39;c1&#39;, 4);</div>
</div><!-- fragment --><ul>
<li>If your data set does not have names (or not enough names), I will use the scheme above, filling in names of the form <code>r0</code>, <code>r1</code>, ... <code>c0</code>, <code>c1</code>, .... Text columns get their own numbering system, <code>t0</code>, <code>t1</code>, ..., which is a little more robust than continuing the column count from the matrix.</li>
</ul>
<ul>
<li>I handle only the matrix and text. </li>
</ul>

</div>
</div>
<a class="anchor" id="a8c4bb25171301f09a35c36306a7b9783"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structapop__data.html">apop_data</a>* apop_data_rank_compress </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td>
          <td class="paramname"><em>in</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>One often finds data where the column indicates the value of the data point. There may be two columns, and a mark in the first indicates a miss while a mark in the second is a hit. Or say that we have the following list of observations:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;2 3 3 2 1 1 2 1 1 2 1 1</div>
</div><!-- fragment --><p> Then we could write this as: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;0  1  2  3</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;----------</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;0  6  4  2</div>
</div><!-- fragment --><p> because there are six 1s observed, four 2s observed, and two 3s observed. We call this rank format, because 1 (or zero) is typically the most common, 2 is second most common, et cetera.</p>
<p>This function takes in a list of observations, and aggregates them into a single row in rank format.</p>
<ul>
<li>For the complement, see <a class="el" href="apop__conversions_8c.html#a2feb17743f8b07b8ddcf457362cabefc">apop_data_rank_expand</a>.</li>
</ul>
<ul>
<li>You may be interested in <a class="el" href="apop__regression_8c.html#a27405bd5fdf48d93c8918ca4c07ee260">apop_data_to_factors</a> to convert real numbers or text into a matrix of categories.</li>
</ul>
<ul>
<li>The number of bins is simply the largest number found. So if there are bins {0, 1, 2} and your data set happens to consist of <code>0 0 1 1 0</code>, then I won't know to generate results with three bins where the last bin has probability zero.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">/* A round trip: generate Zipf-distributed draws, summarize them to a single list of</span></div>
<div class="line"><span class="comment">rankings, then expand the rankings to a list of single entries. The sorted list at the end</span></div>
<div class="line"><span class="comment">of this should be identical to the (sorted) original list. */</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="apop_8h.html">apop.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    gsl_rng *r = <a class="code" href="group__convenience__fns.html#gada044cf02135422a9f9292b6054c86dd">apop_rng_alloc</a>(2342);</div>
<div class="line">    <span class="keywordtype">int</span> i, length = 1e4;</div>
<div class="line">    <a class="code" href="structapop__model.html">apop_model</a> *a_zipf = <a class="code" href="group__models.html#ga36cae46a2950eb6cfb65794cdd5dac7e">apop_model_set_parameters</a>(<a class="code" href="group__models.html#ga32e7ca1164025cbb53a9e0ecee9d4cea">apop_zipf</a>, 3.2);</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *draws = <a class="code" href="apop_8h.html#ac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(length);</div>
<div class="line">    <span class="keywordflow">for</span> (i=0; i&lt; length; i++)</div>
<div class="line">        <a class="code" href="group__models.html#ga87f15cd1923ed7b5b46e52a77ca1dfef">apop_draw</a>(<a class="code" href="group__data__set__get.html#ga59d1c0299c7eb87224bc6c60555784fe">apop_data_ptr</a>(draws, i, -1), r, a_zipf);</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *by_rankings = <a class="code" href="apop_8h.html#a8c4bb25171301f09a35c36306a7b9783">apop_data_rank_compress</a>(draws);</div>
<div class="line">    <span class="comment">//The first row of the matrix is suitable for plotting.</span></div>
<div class="line">    <span class="comment">//apop_data_show(by_rankings);</span></div>
<div class="line">    assert(<a class="code" href="group__convenience__fns.html#ga369c774aac917e56d8e32f9c66d9c2a0">apop_matrix_sum</a>(by_rankings-&gt;matrix) == length);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *re_expanded = <a class="code" href="apop_8h.html#a2feb17743f8b07b8ddcf457362cabefc">apop_data_rank_expand</a>(by_rankings);</div>
<div class="line">    gsl_sort_vector(draws-&gt;vector);</div>
<div class="line">    gsl_sort_vector(re_expanded-&gt;vector);</div>
<div class="line">    assert(<a class="code" href="group__convenience__fns.html#ga44a77f5e6867c627fd313f3f6e252ff8">apop_vector_distance</a>(draws-&gt;vector, re_expanded-&gt;vector) &lt; 1e-5);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="a2feb17743f8b07b8ddcf457362cabefc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structapop__data.html">apop_data</a>* apop_data_rank_expand </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td>
          <td class="paramname"><em>in</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The complement to this is <a class="el" href="apop__conversions_8c.html#a8c4bb25171301f09a35c36306a7b9783">apop_data_rank_compress</a>; see that function's documentation for the story and an example.</p>
<p>This function takes in a data set where the zeroth column includes the count(s) of times that zero was observed, the first gives the count(s) of times that one was observed, et cetera. It outputs a data set whose vector element includes a list that has exactly the given frequency of zeros, ones, et cetera. </p>

</div>
</div>
<a class="anchor" id="aebe17fe6f2b0c49c0c90824b7a68ff90"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structapop__data.html">apop_data</a>* apop_db_to_crosstab </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>tabname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>r1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>r2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>datacol</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Give the name of a table in the database, and names of three of its columns: the x-dimension, the y-dimension, and the data. the output is a 2D matrix with rows indexed by r1 and cols by r2.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tabname</td><td>The database table I'm querying. Anything that will work inside a <code>from</code> clause is OK, such as a subquery in parens. </td></tr>
    <tr><td class="paramname">r1</td><td>The column of the data set that will indicate the rows of the output crosstab </td></tr>
    <tr><td class="paramname">r2</td><td>The column of the data set that will indicate the columns of the output crosstab </td></tr>
    <tr><td class="paramname">datacol</td><td>The column of the data set holding the data for the cells of the crosstab</td></tr>
  </table>
  </dd>
</dl>
<ul>
<li>If the query to get data to fill the table (select r1, r2, datacol from tabname) returns an empty data set, then I will return a <code>NULL</code> data set and if <code>apop_opts.verbosity &gt;= 1</code> print a warning.</li>
</ul>
<ul>
<li>This setup presumes that there is one value for each (row, col) coordinate in the data. You may want an aggregate instead. There are two ways to do this, both of which hack the fact that this function runs a simple <code>select</code> query to generate the data. One is to specify an ad hoc table to pull from:</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;apop_data * out = apop_db_to_crosstab(&quot;(select row, col, count(*) ct from base_data group by row, col)&quot;, &quot;row&quot;, &quot;col&quot;,  &quot;ct&quot;);</div>
</div><!-- fragment --><p>The other is to use the fact that the table name will be at the end of the query, so you can add conditions to the table:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;apop_data * out = apop_db_to_crosstab(&quot;base_data group by row, col&quot;, &quot;row&quot;, &quot;col&quot;, &quot;count(*)&quot;);</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;//which will expand to &quot;select row, col, count(*) from base_data group by row, col&quot;</div>
</div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="apop__conversions_8c.html#aee8c299b83b8500b8b6ecd30817353c8">apop_crosstab_to_db</a></dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">out-&gt;error='n'</td><td>Name not found error. </td></tr>
    <tr><td class="paramname">out-&gt;error='q'</td><td>Query returned an empty table (which might mean that it just failed). </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac6114b6a2be902c83a75d4367db4371f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* prep_string_for_sqlite </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>prepped_statements</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>astring</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>&ndash;If the string has zero length, then it's probably a missing value. &ndash;If the string isn't a number, it needs quotes </p>

</div>
</div>
</div><!-- contents -->
<p><p>
<div class="tiny">Autogenerated by doxygen on Mon Apr 20 2015.</div></body></html>

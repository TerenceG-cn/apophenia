<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html> <head>
     <title>Apophenia: a library for scientific computing</title>

<!-- Google is watching. -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-134313-2";
urchinTracker();
</script>


     <link rel="stylesheet" href="typical.css" type="text/css" >
     <script  type="text/javascript" language="JavaScript" src="tree.js"></script>
</head><body>
     <center><table cellpadding=10pt>
     <tr> <td><img width=140px src=flake.gif alt="Patterns in static"></td> 
    <td><table>
     	<tr> <td><center><h2><a href="http://apophenia.info">Apophenia</a></h2></center></td></tr>
<tr><td><div class="qindex"><a class="qindex" href="index.html">&nbsp;Intro</a> | <a class="qindex" href="outline.html">Outline</a> | <a class="qindex" href="globals.html">Index</a> <!--| <a class="qindex" href="files.html">File&nbsp;List&nbsp;</a> -->  </div></td></tr></table>
	</td></tr></table></center>

    <div> <!--Doxygen generates an extra </div>.-->
<!-- Generated by Doxygen 1.7.6.1 -->
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">apop_sort.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__sort_8c.html#acefe4dee819c090e57ac69d4d8bdcfd0">apop_data_sort</a> (<a class="el" href="structapop__data.html">apop_data</a> *data, <a class="el" href="structapop__data.html">apop_data</a> *sort_order, char asc, char inplace, double *col_order)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Copyright (c) 2013 by Ben Klemens. Licensed under the modified GNU GPL v2; see COPYING and COPYING2. </p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="acefe4dee819c090e57ac69d4d8bdcfd0"></a><!-- doxytag: member="apop_sort.c::apop_data_sort" ref="acefe4dee819c090e57ac69d4d8bdcfd0" args="(apop_data *data, apop_data *sort_order, char asc, char inplace, double *col_order)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structapop__data.html">apop_data</a>* <a class="el" href="apop__sort_8c.html#acefe4dee819c090e57ac69d4d8bdcfd0">apop_data_sort</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td>
          <td class="paramname"><em>sort_order</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>asc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>inplace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>col_order</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sort an <a class="el" href="gentle.html#apop_data">apop_data</a> set on an arbitrary sequence of columns.</p>
<p>The <code>sort_order</code> set is a one-row data set that should look like the data set being sorted. The easiest way to generate it is to use <a class="el" href="apop_8h.html#a401dbc60c9915be8e4c4def68b22d755">Apop_r</a> to pull one row of the table, then copy and fill it. For each column you want used in the sort, assign a ranking giving whether the column should be sorted first, second, .... Columns you don't want used in the sorting should be set to <code>NAN</code>. Ties are broken by the earlier element in the default order (see below).</p>
<p>E.g., to sort by the last column of a five-column matrix first, then the next-to-last column, then the next-to-next-to-last, then by the first text column, then by the second text column:</p>
<div class="fragment"><pre class="fragment"><a class="code" href="structapop__data.html">apop_data</a> *sort_order = <a class="code" href="apop_8h.html#add67e6838ce2521a1d756894dc9b5ccf">apop_data_copy</a>(<a class="code" href="apop_8h.html#a401dbc60c9915be8e4c4def68b22d755">Apop_r</a>(data, 0));
sort_order-&gt;vector = NULL; <span class="comment">//so it will be skipped.</span>
Apop_data_fill(sort_order, NAN, NAN, 3, 2, 1);
<a class="code" href="apop_8h.html#ac9c6f645acce82319fb85eb9d75112ba">apop_text_add</a>(sort_order, 0, 0, <span class="stringliteral">&quot;4&quot;</span>);
<a class="code" href="apop_8h.html#ac9c6f645acce82319fb85eb9d75112ba">apop_text_add</a>(sort_order, 0, 1, <span class="stringliteral">&quot;5&quot;</span>);
<a class="code" href="apop_8h.html#acefe4dee819c090e57ac69d4d8bdcfd0">apop_data_sort</a>(data, sort_order);
</pre></div><p>I use only comparisons, not the actual numeric values, so you can use any sequence of numbers: (1, 2, 3) and (-1.32, 0, 27) work identically.</p>
<ul>
<li>Strings are sorted case-insensitively, using <code>strcasecmp</code>. [exercise for the reader: modify the source to use Glib's locale-correct string sorting.]</li>
</ul>
<ul>
<li>The setup generates a lexicographic sort using the columns you specify. If you would like a different sort order, such as Euclidian distance to the origin, you can generate a new column expressing your preferred metric, and then sorting on that. See the example below.</li>
</ul>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>The data set to be sorted. If <code>NULL</code>, this function is a no-op that returns <code>NULL</code>. </td></tr>
    <tr><td class="paramname">sort_order</td><td>A <a class="el" href="gentle.html#apop_data">apop_data</a> set describing the order in which columns are used for sorting, as above. If <code>NULL</code>, then sort by the vector, then each matrix column, then text, then weights, then row names. </td></tr>
    <tr><td class="paramname">inplace</td><td>If 'n', make a copy, else sort in place. (default: 'y'). </td></tr>
    <tr><td class="paramname">asc</td><td>If 'a', ascending; if 'd', descending. This is applied to all columns; column-by-column application is to do. (default: 'a'). </td></tr>
    <tr><td class="paramname">col_order</td><td>For internal use only. In your call, it should be <code>NULL</code>; the <a class="el" href="designated.html">Designated initializers</a> syntax will takes care of it for you.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A pointer to the sorted data set. If <code>inplace=='y'</code> (the default), then this is the same as the input set.</dd></dl>
<p>A few examples:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#ifdef Datadir</span>
<span class="preprocessor"></span><span class="preprocessor">#define DATADIR Datadir</span>
<span class="preprocessor"></span><span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#define DATADIR &quot;.&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;<a class="code" href="apop_8h.html">apop.h</a>&gt;</span>
<span class="preprocessor">#include &lt;unistd.h&gt;</span>
<span class="preprocessor">#ifdef Testing</span>
<span class="preprocessor"></span><span class="preprocessor">#include &quot;sort_tests.c&quot;</span> <span class="comment">//For Apophenia&#39;s test suite, some tedious checks that the sorts worked</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="comment">//get_distance is for the sort-by-Euclidian distance example below.</span>
<span class="keywordtype">double</span> get_distance(gsl_vector *v) {<span class="keywordflow">return</span> <a class="code" href="group__convenience__fns.html#ga44a77f5e6867c627fd313f3f6e252ff8">apop_vector_distance</a>(v);}

<span class="keywordtype">int</span> main(){
    <a class="code" href="group__conversions.html#gabd00e16791a970631c3ed4ac3487da46">apop_text_to_db</a>( DATADIR <span class="stringliteral">&quot;/&quot;</span> <span class="stringliteral">&quot;amash_vote_analysis.csv&quot;</span> , .tabname=<span class="stringliteral">&quot;amash_vote_analysis&quot;</span>);
    <a class="code" href="structapop__data.html">apop_data</a> *d = <a class="code" href="group__queries.html#ga1f06db34e05b5afb63112f83ad2317b8">apop_query_to_mixed_data</a>(<span class="stringliteral">&quot;mntmtm&quot;</span>, <span class="stringliteral">&quot;select 1,id,party,contribs/1000.0,vote,ideology from amash_vote_analysis &quot;</span>);

    <span class="comment">//use the default order of columns for sorting</span>
    <a class="code" href="structapop__data.html">apop_data</a> *sorted = <a class="code" href="apop_8h.html#acefe4dee819c090e57ac69d4d8bdcfd0">apop_data_sort</a>(d, .inplace=<span class="charliteral">&#39;n&#39;</span>);
<span class="preprocessor">#ifndef Testing</span>
<span class="preprocessor"></span>    <a class="code" href="group__apop__print.html#gab45a848e5dbcaf82b5b95cd03f7b396a">apop_data_print</a>(sorted);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    check_sorting1(sorted);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="comment">//set up a specific column order</span>
    <a class="code" href="structapop__data.html">apop_data</a> *perm = <a class="code" href="apop_8h.html#add67e6838ce2521a1d756894dc9b5ccf">apop_data_copy</a>(<a class="code" href="apop_8h.html#a401dbc60c9915be8e4c4def68b22d755">Apop_r</a>(d, 0));
    perm-&gt;vector = NULL;
    <a class="code" href="apop_8h.html#ad6be56d710a63aa1ceadf2242c553905">apop_data_fill</a>(perm, 5, 3, 4);
    <a class="code" href="apop_8h.html#ac9c6f645acce82319fb85eb9d75112ba">apop_text_add</a>(perm, 0, 0, <span class="stringliteral">&quot;2&quot;</span>);
    <a class="code" href="apop_8h.html#ac9c6f645acce82319fb85eb9d75112ba">apop_text_add</a>(perm, 0, 1, <span class="stringliteral">&quot;1&quot;</span>);

    <a class="code" href="apop_8h.html#acefe4dee819c090e57ac69d4d8bdcfd0">apop_data_sort</a>(d, perm);
<span class="preprocessor">#ifndef Testing</span>
<span class="preprocessor"></span>    <a class="code" href="group__apop__print.html#gab45a848e5dbcaf82b5b95cd03f7b396a">apop_data_print</a>(d);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    check_sorting2(d);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="comment">//sort a list of names</span>
    <a class="code" href="structapop__data.html">apop_data</a> *blank = <a class="code" href="apop_8h.html#ac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>();
    <a class="code" href="apop_8h.html#aeca6159c82c21da0db82ae9ed0582dc6">apop_data_add_names</a>(blank, <span class="charliteral">&#39;r&#39;</span>, <span class="stringliteral">&quot;C&quot;</span>, <span class="stringliteral">&quot;E&quot;</span>, <span class="stringliteral">&quot;A&quot;</span>);
    <a class="code" href="apop_8h.html#acefe4dee819c090e57ac69d4d8bdcfd0">apop_data_sort</a>(blank);
    assert(*blank-&gt;names-&gt;row[0] == <span class="charliteral">&#39;A&#39;</span>);
    assert(*blank-&gt;names-&gt;row[1] == <span class="charliteral">&#39;C&#39;</span>);
    assert(*blank-&gt;names-&gt;row[2] == <span class="charliteral">&#39;E&#39;</span>);

    <span class="comment">//take each row of the matrix as a vector; store the Euclidian distance to the origin in the vector;</span>
    <span class="comment">//sort in descending order.</span>
    <a class="code" href="structapop__data.html">apop_data</a> *rowvectors = <a class="code" href="group__conversions.html#ga630de5d4fcbe9ef13373029f5d813a97">apop_text_to_data</a>( DATADIR <span class="stringliteral">&quot;/&quot;</span> <span class="stringliteral">&quot;test_data&quot;</span> );
    <a class="code" href="group__mapply.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(rowvectors, .fn_v=get_distance, .part=<span class="charliteral">&#39;r&#39;</span>, .inplace=<span class="charliteral">&#39;y&#39;</span>);
    <a class="code" href="structapop__data.html">apop_data</a> *arow = <a class="code" href="apop_8h.html#add67e6838ce2521a1d756894dc9b5ccf">apop_data_copy</a>(<a class="code" href="apop_8h.html#a401dbc60c9915be8e4c4def68b22d755">Apop_r</a>(rowvectors, 0));
    arow-&gt;matrix=NULL; <span class="comment">//sort only by the distance vector</span>
    <a class="code" href="apop_8h.html#acefe4dee819c090e57ac69d4d8bdcfd0">apop_data_sort</a>(rowvectors, arow, .asc=<span class="charliteral">&#39;d&#39;</span>);
<span class="preprocessor">#ifndef Testing</span>
<span class="preprocessor"></span>    <a class="code" href="group__output.html#ga9a30c437ec11a11e37e0db7f82386275">apop_data_show</a>(rowvectors);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="keywordtype">double</span> prev = INFINITY;
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; rowvectors-&gt;vector-&gt;size; i++){
        <span class="keywordtype">double</span> <span class="keyword">this</span> = <a class="code" href="group__data__set__get.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(rowvectors, i, -1);
        assert(<span class="keyword">this</span> &lt; prev);
        prev = <span class="keyword">this</span>;
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}
</pre></div><ul>
<li>This function uses the <a class="el" href="designated.html">Designated initializers</a> syntax for inputs. </li>
</ul>

</div>
</div>
</div><!-- contents -->
<p><p>
<div class="tiny">Autogenerated by doxygen on Sun Sep 7 2014.</div></body></html>

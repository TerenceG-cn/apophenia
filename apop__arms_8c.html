<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html> <head>
     <title>Apophenia: a library for scientific computing</title>
<!-- Google is watching. -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-134313-2";
urchinTracker();
</script>
     <link rel="stylesheet" href="typical.css" type="text/css" >
     <script  type="text/javascript" language="JavaScript" src="tree.js"></script>
</head><body>
     <center><table cellpadding=10pt>
     <tr> <td><img width=140px src=flake.gif alt="Patterns in static"></td> 
    <td><table>
     	<tr> <td><center><h2><a href="http://apophenia.info">Apophenia</a></h2></center></td></tr>
<tr><td><div class="qindex"><a class="qindex" href="index.html">&nbsp;Intro</a> | <a class="qindex" href="outline.html">Outline</a> | <a class="qindex" href="globals.html">Index</a> <!--| <a class="qindex" href="files.html">File&nbsp;List&nbsp;</a> -->  </div></td></tr></table>
	</td></tr></table></center>
    <div> <!--Doxygen generates an extra </div>.-->
<!-- Generated by Doxygen 1.8.9.1 -->
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">apop_arms.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aa4a9d0036b4af0cb71e361bd679b81b7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__arms_8c.html#aa4a9d0036b4af0cb71e361bd679b81b7">XEPS</a>&#160;&#160;&#160;0.00001            /* critical relative x-value difference */</td></tr>
<tr class="separator:aa4a9d0036b4af0cb71e361bd679b81b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a603f2ebe6557da741e47d4ab770def0f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a603f2ebe6557da741e47d4ab770def0f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>YEPS</b>&#160;&#160;&#160;0.1                /* critical y-value difference */</td></tr>
<tr class="separator:a603f2ebe6557da741e47d4ab770def0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89dab1ff544c347490393156d8fec870"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a89dab1ff544c347490393156d8fec870"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EYEPS</b>&#160;&#160;&#160;0.001              /* critical relative exp(y) difference */</td></tr>
<tr class="separator:a89dab1ff544c347490393156d8fec870"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96571cf1d014e3fd84a741e5be43e963"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a96571cf1d014e3fd84a741e5be43e963"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>YCEIL</b>&#160;&#160;&#160;50.                /* maximum y avoiding overflow in exp(y) */</td></tr>
<tr class="separator:a96571cf1d014e3fd84a741e5be43e963"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6f6153535e836ce954aad79fb0221837"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6f6153535e836ce954aad79fb0221837"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>invert</b> (double prob, arms_state *env, POINT *p)</td></tr>
<tr class="separator:a6f6153535e836ce954aad79fb0221837"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a0740127bb6b586d734a1643a87c126"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2a0740127bb6b586d734a1643a87c126"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>test</b> (arms_state *state, POINT *p, <a class="el" href="structapop__arms__settings.html">apop_arms_settings</a> *params, gsl_rng *r)</td></tr>
<tr class="separator:a2a0740127bb6b586d734a1643a87c126"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5649ee77820050c5a630a82101e1f7b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af5649ee77820050c5a630a82101e1f7b"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>update</b> (arms_state *state, POINT *p, <a class="el" href="structapop__arms__settings.html">apop_arms_settings</a> *params)</td></tr>
<tr class="separator:af5649ee77820050c5a630a82101e1f7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc3386ef11233beb41e3e86c8476425e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afc3386ef11233beb41e3e86c8476425e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>meet</b> (POINT *q, arms_state *state, <a class="el" href="structapop__arms__settings.html">apop_arms_settings</a> *params)</td></tr>
<tr class="separator:afc3386ef11233beb41e3e86c8476425e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ecb8e65db1ffd704d77171c29f21304"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7ecb8e65db1ffd704d77171c29f21304"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>area</b> (POINT *q)</td></tr>
<tr class="separator:a7ecb8e65db1ffd704d77171c29f21304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa853b73d0a4f1be9e583d7923cd376c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaa853b73d0a4f1be9e583d7923cd376c"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>expshift</b> (double y, double y0)</td></tr>
<tr class="separator:aaa853b73d0a4f1be9e583d7923cd376c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5a05eb0c1527d09fa47d32cf91aacc9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af5a05eb0c1527d09fa47d32cf91aacc9"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>logshift</b> (double y, double y0)</td></tr>
<tr class="separator:af5a05eb0c1527d09fa47d32cf91aacc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66ba169b4e48cbb6495908259abb8e7c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a66ba169b4e48cbb6495908259abb8e7c"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>perfunc</b> (<a class="el" href="structapop__arms__settings.html">apop_arms_settings</a> *, double x)</td></tr>
<tr class="separator:a66ba169b4e48cbb6495908259abb8e7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d2aff27c5c0b77e81255fe98990dd62"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4d2aff27c5c0b77e81255fe98990dd62"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>display</b> (FILE *f, arms_state *env, <a class="el" href="structapop__arms__settings.html">apop_arms_settings</a> *)</td></tr>
<tr class="separator:a4d2aff27c5c0b77e81255fe98990dd62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe3a7c80b8f77e9060471dc93feeb8df"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abe3a7c80b8f77e9060471dc93feeb8df"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>initial</b> (<a class="el" href="structapop__arms__settings.html">apop_arms_settings</a> *params, arms_state *state)</td></tr>
<tr class="separator:abe3a7c80b8f77e9060471dc93feeb8df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5fc2842fa004d1fbf774e6f5db810fe"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad5fc2842fa004d1fbf774e6f5db810fe"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>Apop_settings_copy</b> (apop_arms, out-&gt;state=malloc(sizeof(arms_state));*out-&gt;state=*in-&gt;state;) <a class="el" href="apop_8h.html#a833e962fb042462eeadada7484671f07">Apop_settings_free</a>(apop_arms</td></tr>
<tr class="separator:ad5fc2842fa004d1fbf774e6f5db810fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfe03f2ea8ce6ef8d815825c431c04af"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abfe03f2ea8ce6ef8d815825c431c04af"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>if</b> (in-&gt;state)</td></tr>
<tr class="separator:abfe03f2ea8ce6ef8d815825c431c04af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8abec14a73c32be2efe701e59f0a17d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad8abec14a73c32be2efe701e59f0a17d"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>Apop_settings_init</b> (apop_arms, if((in.xl||in.xr)&amp;&amp;!in.xinit) out-&gt;xinit=(double[]){in.xl+GSL_DBL_EPSILON,(in.xl+in.xr)/2., in.xr-GSL_DBL_EPSILON};else{Apop_varad_set(xinit,((double[]){-1, 0, 1}));}Apop_varad_set(ninit, 3);Apop_varad_set(xl, GSL_MIN(out-&gt;xinit[0]/10., out-&gt;xinit[0]*10)-.1);Apop_varad_set(xr, GSL_MAX(out-&gt;xinit[out-&gt;ninit-1]/10., out-&gt;xinit[out-&gt;ninit-1]*10)+.1);Apop_varad_set(convex, 0);Apop_varad_set(npoint, 100);Apop_varad_set(do_metro, 'y');Apop_varad_set(xprev,(out-&gt;xinit[0]+out-&gt;xinit[out-&gt;ninit-1])/2.);Apop_varad_set(neval, 1000);Apop_assert(out-&gt;model,&quot;the model input (e.g.: .model = parent_model) is mandatory.&quot;);out-&gt;state=malloc(sizeof(arms_state));Apop_assert(out-&gt;state,&quot;Malloc failed. Out of memory?&quot;);*out-&gt;state=(arms_state){};int err=initial(out, out-&gt;state);Apop_assert_c(!err, NULL, 0,&quot;init failed, error %i. Returning NULL&quot;, err);if(out-&gt;do_metro=='y'){out-&gt;state-&gt;metro_xprev=out-&gt;xprev;out-&gt;state-&gt;metro_yprev=perfunc(out, out-&gt;xprev);assert(isfinite(out-&gt;state-&gt;metro_xprev));assert(isfinite(out-&gt;state-&gt;metro_yprev));}) void distract_doxygen_arms()</td></tr>
<tr class="separator:ad8abec14a73c32be2efe701e59f0a17d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0492d6f5ae8a73a60b651cadb113d643"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__arms_8c.html#a0492d6f5ae8a73a60b651cadb113d643">apop_arms_draw</a> (double *out, gsl_rng *r, <a class="el" href="structapop__model.html">apop_model</a> *m)</td></tr>
<tr class="memdesc:a0492d6f5ae8a73a60b651cadb113d643"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adaptive rejection metropolis sampling.  <a href="#a0492d6f5ae8a73a60b651cadb113d643">More...</a><br /></td></tr>
<tr class="separator:a0492d6f5ae8a73a60b651cadb113d643"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>adaptive rejection metropolis sampling </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="aa4a9d0036b4af0cb71e361bd679b81b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XEPS&#160;&#160;&#160;0.00001            /* critical relative x-value difference */</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>(C) Wally Gilks; see documentation below for details. Adaptations for Apophenia (c) 2009 by Ben Klemens. Licensed under the GPLv2; see COPYING. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0492d6f5ae8a73a60b651cadb113d643"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int apop_arms_draw </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gsl_rng *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structapop__model.html">apop_model</a> *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adaptive rejection metropolis sampling. </p>
<p>This is a function to make random draws from any univariate distribution (more or less).</p>
<p>The author, Wally Gilks, explains on <a href="http://www.amsta.leeds.ac.uk/~wally.gilks/adaptive.rejection/web_page/Welcome.html,">http://www.amsta.leeds.ac.uk/~wally.gilks/adaptive.rejection/web_page/Welcome.html,</a> that ``ARS works by constructing an envelope function of the log of the target density, which is then used in rejection sampling (see, for example, Ripley, 1987). Whenever a point is rejected by ARS, the envelope is updated to correspond more closely to the true log density, thereby reducing the chance of rejecting subsequent points. Fewer ARS rejection steps implies fewer point-evaluations of the log density.''</p>
<ul>
<li>It accepts only functions with univariate inputs. I.e., it will put a single value in the vector part of a <a class="el" href="gentle.html#apop_data">apop_data</a> set, and then evaluate the log likelihood at that point.</li>
</ul>
<ul>
<li>It is currently the default for the <a class="el" href="group__models.html#ga87f15cd1923ed7b5b46e52a77ca1dfef">apop_draw</a> function, so you can just call that if you prefer.</li>
</ul>
<ul>
<li>There are a great number of parameters, in the <code><a class="el" href="structapop__arms__settings.html">apop_arms_settings</a></code> structure. The structure also holds a history of the points tested to date. That means that the system will be more accurate as more draws are made. It also means that if the parameters change, or you use <a class="el" href="group__models.html#ga87d3a65f43071b9d61d9edd59249c629">apop_model_copy</a>, you should call <code><a class="el" href="group__settings.html#ga4ff4361f65c1e848fabce24b4b8f44f7">Apop_settings_rm_group(your_model, apop_arms)</a></code> to clear the model of points that are not valid for a different situation.</li>
</ul>
<ul>
<li>See <a class="el" href="structapop__arms__settings.html">apop_arms_settings</a> for the list of parameters that you may want to set, via a form like <code>apop_model_add_group(your_model, apop_arms, .model=your_model, .xl=8, .xr =14);</code>. The <code>model</code> element is mandatory; you'll get a run-time complaint if you forget it. </li>
</ul>

</div>
</div>
</div><!-- contents -->
<p><p>
<div class="tiny">Autogenerated by doxygen on Mon Apr 20 2015.</div></body></html>

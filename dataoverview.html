<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
     <title>Apophenia: a library for scientific computing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
     <link rel="stylesheet" href="typical.css" type="text/css" >
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!-- Google is watching. -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-134313-2";
urchinTracker();
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="typical.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<center><table cellpadding=10pt>
<tr> <td><img width=140px src=flake.gif alt="Patterns in static"></td>
<td><table>
    <tr> <td><center><h2><a href="http://apophenia.info">Apophenia</a></h2></center></td></tr>
    <tr><td><div class="qindex"> <a class="qindex" href="outline.html">Outline</a> | <a class="qindex" href="group__all__public.html">Index </a>  |         <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
                <!-- <a class="qindex" href="files.html">File&nbsp;List&nbsp;</a> -->  </div></td></tr></table>
                                  </td></tr></table></center>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dataoverview.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Data sets </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a class="el" href="gentle.html#apop_data">apop_data</a> structure represents a data set. It joins together a <code>gsl_vector</code>, a <code>gsl_matrix</code>, an <a class="el" href="structapop__name.html">apop_name</a>, and a table of strings. It tries to be lightweight, so you can use it everywhere you would use a <code>gsl_matrix</code> or a <code>gsl_vector</code>.</p>
<p>Here is a diagram showing a sample data set with all of the elements in place. Together, they represent a data set where each row is an observation, which includes both numeric and text values, and where each row/column may be named.</p>
<table frame=box>
<tr>
<td>Rowname</td><td>Vector</td><td> Matrix</td><td> Text</td><td>Weights</td>
</tr><tr valign=bottom>
<td align=center>
<table frame=box>
<tr><td> </td></tr>
<tr>
<td>"Steven"</td>
</tr><tr>
<td>"Sandra"</td>
</tr><tr>
<td>"Joe"</td><td>
</tr> 
</table>
</td><td align=center>
<table frame=box>
<tr>
<th>Outcome</th>
</tr> <tr>
<td align=center>1</td>
</tr><tr>
<td align=center>0</td>
</tr><tr>
<td align=center>1</td>
</tr> 
</table>
</td><td align=center>
<table frame=box>
<tr>
<th> Age</th><th> Weight (kg)</th><th> Height (cm)</th>
</tr> <tr>
<td> 32</td><td> 65</td><td> 175</td>
</tr><tr>
<td> 41</td><td> 61</td><td> 165</td>
</tr><tr>
<td> 40</td><td> 73</td><td> 181</td>
</tr> 
</table>
</td><td align=center>
<table frame=box>
<tr>
<th> Sex</th><th> State</th>
</tr>
<tr>
<td> Male</td><td> Alaska</td><td>
</tr><tr>
<td> Female</td><td> Alabama</td>
</tr><tr>
<td> Male</td><td> Alabama</td>
</tr> 
</table>
</td><td align=center>
<table frame=box>
<tr><td> </td></tr>
<tr>
<td>1</td>
</tr><tr>
<td>3.2</td>
</tr><tr>
<td>2.4</td>
</tr> 
</table>
</td></tr>
</table>
 <p>In a regression, the vector would be the dependent variable, and the other columns (after factor-izing the text) the independent variables. Or think of the <a class="el" href="gentle.html#apop_data">apop_data</a> set as a partitioned matrix, where the vector is column -1, and the first column of the matrix is column zero. Here is some sample code to print the vector and matrix, starting at column -1 (but you can use <a class="el" href="group__all__public.html#gab45a848e5dbcaf82b5b95cd03f7b396a">apop_data_print</a> to do this).</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j&lt; data-&gt;matrix-&gt;size1; j++){</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s\t&quot;</span>, apop_name_get(data-&gt;names, j, <span class="charliteral">&#39;r&#39;</span>));</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = -1; i&lt; data-&gt;matrix-&gt;size2; i++)</div>
<div class="line">        printf(<span class="stringliteral">&quot;%g\t&quot;</span>, <a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(data, j, i));</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Most functions assume that each row represents one observation, so the data vector, data matrix, and text have the same row count: <code>data-&gt;vector-&gt;size==data-&gt;matrix-&gt;size1</code> and <code>data-&gt;vector-&gt;size==*data-&gt;textsize</code>. This means that the <a class="el" href="structapop__name.html">apop_name</a> structure doesn't have separate <code>vector_names</code>, <code>row_names</code>, or <code>text_row_names</code> elements: the <code>rownames</code> are assumed to apply for all.</p>
<p>See below for notes on easily managing the <code>text</code> element and the row/column names.</p>
<h1><a class="anchor" id="pps"></a>
Pages</h1>
<p>The <a class="el" href="gentle.html#apop_data">apop_data</a> set includes a <code>more</code> pointer, which will typically be <code>NULL</code>, but may point to another <a class="el" href="gentle.html#apop_data">apop_data</a> set. This is intended for a main data set and a second or third page with auxiliary information, such as estimated parameters on the front page and their covariance matrix on page two, or predicted data on the front page and a set of prediction intervals on page two.</p>
<p>The <code>more</code> pointer is not intended as a linked list for millions of data points. In such situations, you can often improve efficiency by restructuring your data to use a single table (perhaps via <a class="el" href="group__all__public.html#ga90feb5dd661cfe0f0b53a85295b8b56e">apop_data_pack</a> and <a class="el" href="group__all__public.html#gae3058b7f39d0442f13284464d1ba235d">apop_data_unpack</a>).</p>
<p>Most functions, such as <a class="el" href="group__all__public.html#gadd67e6838ce2521a1d756894dc9b5ccf">apop_data_copy</a> and <a class="el" href="group__all__public.html#ga459acfde11f2c39f5c32cff377f85b9e">apop_data_free</a>, will handle all the pages of information. For example, an optimization search over multi-page parameter sets would search the space given by all pages.</p>
<p>But pages may also be appended as output or auxiliary information, such as covariances, and an MLE would not search over these elements. Any page with a name in XML-ish brackets, such as <code>&lt;Covariance&gt;</code>, is considered information about the data, not data itself, and therefore ignored by search routines, missing data routines, et cetera. This is achieved by a rule in <a class="el" href="group__all__public.html#ga90feb5dd661cfe0f0b53a85295b8b56e">apop_data_pack</a> and <a class="el" href="group__all__public.html#gae3058b7f39d0442f13284464d1ba235d">apop_data_unpack</a>.</p>
<p>Here is a toy example that establishes a baseline data set, adds a page, modifies it, and then later retrieves it. </p><div class="fragment"><div class="line"><a class="code" href="structapop__data.html">apop_data</a> *d = <a class="code" href="group__all__public.html#gac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(10, 10, 10); <span class="comment">//the base data set, a 10-item vector + 10x10 matrix</span></div>
<div class="line"><a class="code" href="structapop__data.html">apop_data</a> *a_new_page = <a class="code" href="group__all__public.html#ga7e7e530a692571a403e5837fda5e0f12">apop_data_add_page</a>(d, <a class="code" href="group__all__public.html#gac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(2,2), <span class="stringliteral">&quot;new 2 x 2 page&quot;</span>);</div>
<div class="line">gsl_vector_set_all(a_new_page-&gt;matrix, 3);</div>
<div class="line"></div>
<div class="line"><span class="comment">//later:</span></div>
<div class="line"><a class="code" href="structapop__data.html">apop_data</a> *retrieved = <a class="code" href="group__all__public.html#ga044771db76f0afb410a8d4f05ac51ca3">apop_data_get_page</a>(d, <span class="stringliteral">&quot;new&quot;</span>, <span class="charliteral">&#39;r&#39;</span>); <span class="comment">//&#39;r&#39;=search via regex, not literal match.</span></div>
<div class="line">apop_data_show(retrieved); <span class="comment">//print a 2x2 grid of 3s.</span></div>
</div><!-- fragment --><h1><a class="anchor" id="datafns"></a>
Functions for using apop_data sets</h1>
<p>There are a great many functions to collate, copy, merge, sort, prune, and otherwise manipulate the <a class="el" href="gentle.html#apop_data">apop_data</a> structure and its components.</p>
<ul>
<li><a class="el" href="group__all__public.html#ga44b767b375fb18f61f939c6869955331">apop_data_add_named_elmt</a> </li>
<li><a class="el" href="group__all__public.html#gadd67e6838ce2521a1d756894dc9b5ccf">apop_data_copy</a> </li>
<li><a class="el" href="group__all__public.html#gad6be56d710a63aa1ceadf2242c553905">apop_data_fill</a> </li>
<li><a class="el" href="group__all__public.html#gaa24d396c7fda38bc4ab03a3ba2db4943">apop_data_memcpy</a> </li>
<li><a class="el" href="group__all__public.html#ga90feb5dd661cfe0f0b53a85295b8b56e">apop_data_pack</a> </li>
<li><a class="el" href="group__all__public.html#ga1312f6568cfe832f1e35f7f44482ffb4">apop_data_rm_columns</a> </li>
<li><a class="el" href="group__all__public.html#gacefe4dee819c090e57ac69d4d8bdcfd0">apop_data_sort</a> </li>
<li><a class="el" href="group__all__public.html#gaef0284036801cb75d465a1738f65397e">apop_data_split</a> </li>
<li><a class="el" href="group__all__public.html#ga0f2ffb5c5ba2bb240e930be08fc4fd56">apop_data_stack</a> </li>
<li><a class="el" href="group__all__public.html#ga82281b8673cda3645054d7e061bb1167">apop_data_transpose</a> : transpose matrices (square or not) and text grids </li>
<li><a class="el" href="group__all__public.html#gae3058b7f39d0442f13284464d1ba235d">apop_data_unpack</a> </li>
<li><a class="el" href="group__all__public.html#ga45bb322b9f491c46feb1e24025b6301f">apop_matrix_copy</a> </li>
<li><a class="el" href="group__all__public.html#gaa06b6ab6ec9f78f305b1dacc8ec2efd3">apop_matrix_realloc</a> </li>
<li><a class="el" href="group__all__public.html#ga8e30501a20450f8e68f151844c3fbd78">apop_matrix_stack</a> </li>
<li><a class="el" href="group__all__public.html#gae987ac014cda5e483f8c16bfd59147ae">apop_text_set</a> </li>
<li><a class="el" href="group__all__public.html#ga6270ad55c566140e0d7962cb4d5daacc">apop_text_paste</a> </li>
<li><a class="el" href="group__all__public.html#ga630de5d4fcbe9ef13373029f5d813a97">apop_text_to_data</a> </li>
<li><a class="el" href="group__all__public.html#ga5baf0e8717a30fdcfba350da904c1825">apop_vector_copy</a> </li>
<li><a class="el" href="group__all__public.html#gaf9b051e2fbe0e473dddeabfe4932ce0c">apop_vector_fill</a> </li>
<li><a class="el" href="group__all__public.html#ga294d0269c4cbe36709130bebd893938d">apop_vector_stack</a> </li>
<li><a class="el" href="group__all__public.html#gaf4658a3ecc0acfd17f610bc162fa5556">apop_vector_realloc</a></li>
</ul>
<p>Apophenia builds upon the GSL, but it would be inappropriate to redundantly replicate the <a href="http://www.gnu.org/software/gsl/manual/html_node/index.html">GSL's documentation</a> here. Meanwhile, here are prototypes for a few common functions. The GSL's naming scheme is very consistent, so a simple reminder of the function name may be sufficient to indicate how they are used.</p>
<ul>
<li><code>gsl_matrix_swap_rows (gsl_matrix * m, size_t i, size_t j)</code> </li>
<li><code>gsl_matrix_swap_columns (gsl_matrix * m, size_t i, size_t j)</code> </li>
<li><code>gsl_matrix_swap_rowcol (gsl_matrix * m, size_t i, size_t j)</code> </li>
<li><code>gsl_matrix_transpose_memcpy (gsl_matrix * dest, const gsl_matrix * src)</code> </li>
<li><code>gsl_matrix_transpose (gsl_matrix * m) : square matrices only</code> </li>
<li><code>gsl_matrix_set_all (gsl_matrix * m, double x)</code> </li>
<li><code>gsl_matrix_set_zero (gsl_matrix * m)</code> </li>
<li><code>gsl_matrix_set_identity (gsl_matrix * m)</code> </li>
<li><code>gsl_matrix_memcpy (gsl_matrix * dest, const gsl_matrix * src)</code> </li>
<li><code>void gsl_vector_set_all (gsl_vector * v, double x)</code> </li>
<li><code>void gsl_vector_set_zero (gsl_vector * v)</code> </li>
<li><code>int gsl_vector_set_basis (gsl_vector * v, size_t i)</code>: set all elements to zero, but set item <img class="formulaInl" alt="$i$" src="form_13.png"/> to one. </li>
<li><code>gsl_vector_reverse (gsl_vector * v)</code>: reverse the order of your vector's elements </li>
<li><code>gsl_vector_ptr</code> and <code>gsl_matrix_ptr</code>. To increment an element in a vector use, e.g., <code>*gsl_vector_ptr(v, 7) += 3;</code> or <code>(*gsl_vector_ptr(v, 7))++</code>. </li>
<li><code>gsl_vector_memcpy (gsl_vector * dest, const gsl_vector * src)</code></li>
</ul>
<h2><a class="anchor" id="readin"></a>
Reading from text files</h2>
<p>The <a class="el" href="group__all__public.html#ga630de5d4fcbe9ef13373029f5d813a97">apop_text_to_data()</a> function takes in the name of a text file with a grid of data in (comma|tab|pipe|whatever)-delimited format and reads it to a matrix. If there are names in the text file, they are copied in to the data set. See <a class="el" href="text_format.html">Input text file formatting</a> for the full range and details of what can be read in.</p>
<p>If you have any columns of text, then you will need to read in via the database: use <a class="el" href="group__all__public.html#gabd00e16791a970631c3ed4ac3487da46">apop_text_to_db()</a> to convert your text file to a database table, do any database-appropriate cleaning of the input data, then use <a class="el" href="group__all__public.html#gade862993166c6482f53562fb77721db9">apop_query_to_data()</a> or <a class="el" href="group__all__public.html#ga1f06db34e05b5afb63112f83ad2317b8">apop_query_to_mixed_data()</a> to pull the data to an <a class="el" href="gentle.html#apop_data">apop_data</a> set.</p>
<p><a class="el" href="text_format.html">Input text file formatting</a></p>
<h1><a class="anchor" id="datalloc"></a>
Alloc/free</h1>
<p>You may not need to use these functions often, given that <a class="el" href="group__all__public.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a>, <a class="el" href="group__all__public.html#ga630de5d4fcbe9ef13373029f5d813a97">apop_text_to_data</a>, and many transformation functions will auto-allocate <a class="el" href="gentle.html#apop_data">apop_data</a> sets for you.</p>
<p>The <a class="el" href="group__all__public.html#gac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a> function allocates a vector, a matrix, or both. After this call, the structure will have blank names, <code>NULL</code> <code>text</code> element, and <code>NULL</code> <code>weights</code>. See <a class="el" href="dataoverview.html#names">Name handling</a> for discussion of filling the names. Use <a class="el" href="group__all__public.html#ga9fba0f07c262a433133f6f3362617da3">apop_text_alloc</a> to allocate the <code>text</code> grid. The <code>weights</code> are a simple <code>gsl_vector</code>, so allocate a 100-unit weights vector via <code>allocated_data_set-&gt;weights = gsl_vector_alloc(100)</code>.</p>
<p>Examples of use can be found throughout the documentation; for example, see <a class="el" href="gentle.html">A quick overview</a>.</p>
<ul>
<li><a class="el" href="group__all__public.html#gac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a> </li>
<li><a class="el" href="group__all__public.html#ga0460790f2d21f03856ed4a212a4132ec">apop_data_calloc</a> </li>
<li><a class="el" href="group__all__public.html#ga459acfde11f2c39f5c32cff377f85b9e">apop_data_free</a> </li>
<li><a class="el" href="group__all__public.html#ga9fba0f07c262a433133f6f3362617da3">apop_text_alloc</a> : allocate or resize the text part of an <a class="el" href="gentle.html#apop_data">apop_data</a> set. </li>
<li><a class="el" href="group__all__public.html#ga65386d7b37c2eaf37d1eb4e3ae7a7554">apop_text_free</a> <pre class="fragment">See also:
</pre></li>
</ul>
<ul>
<li><code>gsl_matrix * gsl_matrix_alloc (size_t n1, size_t n2)</code> </li>
<li><code>gsl_matrix * gsl_matrix_calloc (size_t n1, size_t n2)</code> </li>
<li><code>void gsl_matrix_free (gsl_matrix * m)</code> </li>
<li><code>gsl_vector * gsl_vector_alloc (size_t n)</code> </li>
<li><code>gsl_vector * gsl_vector_calloc (size_t n)</code> </li>
<li><code>void gsl_vector_free (gsl_vector * v)</code></li>
</ul>
<h1><a class="anchor" id="gslviews"></a>
Using views</h1>
<p>There are several macros for the common task of viewing a single row or column of a <a class="el" href="gentle.html#apop_data">apop_data</a> set.</p>
<div class="fragment"><div class="line"><a class="code" href="structapop__data.html">apop_data</a> *d = <a class="code" href="group__all__public.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a>(<span class="stringliteral">&quot;select obs1, obs2, obs3 from a_table&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Get a column using its name. Note that the generated view, ov, is the</span></div>
<div class="line"><span class="comment">//last item named in the call to the macro.</span></div>
<div class="line"><a class="code" href="group__all__public.html#gaaaf15101ec60ce66e80737375baa7391">Apop_col_t</a>(d, <span class="stringliteral">&quot;obs1&quot;</span>, ov);</div>
<div class="line"><span class="keywordtype">double</span> obs1_sum = <a class="code" href="group__all__public.html#gaf6182181dd424bc4de98b4bfbd349b4e">apop_vector_sum</a>(ov);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Get row zero of the data set&#39;s matrix as a vector; get its sum</span></div>
<div class="line"><span class="keywordtype">double</span> row_zero_sum = <a class="code" href="group__all__public.html#gaf6182181dd424bc4de98b4bfbd349b4e">apop_vector_sum</a>(<a class="code" href="group__all__public.html#ga314f28de914dfe6e45170e09d71d5429">Apop_rv</a>(d, 0));</div>
<div class="line"></div>
<div class="line"><span class="comment">//Get a row or rows as a standalone one-row apop_data set</span></div>
<div class="line"><a class="code" href="group__all__public.html#gab45a848e5dbcaf82b5b95cd03f7b396a">apop_data_print</a>(<a class="code" href="group__all__public.html#ga401dbc60c9915be8e4c4def68b22d755">Apop_r</a>(d, 0));</div>
<div class="line"></div>
<div class="line"><span class="comment">//ten rows starting at row 3:</span></div>
<div class="line"><a class="code" href="structapop__data.html">apop_data</a> *d10 = <a class="code" href="group__all__public.html#ga585f5cf3125fb5fc875dea85980eabd1">Apop_rs</a>(d, 3, 10);</div>
<div class="line">apop_data_show(d10);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Column zero&#39;s sum</span></div>
<div class="line">gsl_vector *cv = <a class="code" href="group__all__public.html#ga825321182fbaa7471069f13447170810">Apop_cv</a>(d, 0);</div>
<div class="line"><span class="keywordtype">double</span> col_zero_sum = <a class="code" href="group__all__public.html#gaf6182181dd424bc4de98b4bfbd349b4e">apop_vector_sum</a>(cv);</div>
<div class="line"><span class="comment">//or one one line:</span></div>
<div class="line"><span class="keywordtype">double</span> col_zero_sum = <a class="code" href="group__all__public.html#gaf6182181dd424bc4de98b4bfbd349b4e">apop_vector_sum</a>(<a class="code" href="group__all__public.html#ga825321182fbaa7471069f13447170810">Apop_cv</a>(d, 0));</div>
<div class="line"></div>
<div class="line"><span class="comment">//Pull a 10x5 submatrix, whose origin element is the (2,3)rd</span></div>
<div class="line"><span class="comment">//element of the parent data set&#39;s matrix</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> sub_sum = <a class="code" href="group__all__public.html#ga369c774aac917e56d8e32f9c66d9c2a0">apop_matrix_sum</a>(<a class="code" href="group__all__public.html#gad0375e20079df9652337e39c1317a14d">Apop_subm</a>(d, 2,3, 10,5));</div>
</div><!-- fragment --><p>Because these macros can be used as arguments to a function, these macros have abbreviated names to save line space.</p>
<ul>
<li><a class="el" href="group__all__public.html#gadabbf2a1717d5c76a834e090ddfcfeaa">Apop_c</a> </li>
<li><a class="el" href="group__all__public.html#ga401dbc60c9915be8e4c4def68b22d755">Apop_r</a> </li>
<li><a class="el" href="group__all__public.html#ga825321182fbaa7471069f13447170810">Apop_cv</a> </li>
<li><a class="el" href="group__all__public.html#ga314f28de914dfe6e45170e09d71d5429">Apop_rv</a> </li>
<li><a class="el" href="group__all__public.html#gafc073d46416446dc4f0cdb9e4f1b9a03">Apop_cs</a> </li>
<li><a class="el" href="group__all__public.html#ga585f5cf3125fb5fc875dea85980eabd1">Apop_rs</a> </li>
<li><a class="el" href="group__all__public.html#gad0375e20079df9652337e39c1317a14d">Apop_subm</a></li>
</ul>
<p>A second set of macros have a slightly different syntax, taking the name of the object to be declared as the last argument. These can not be used as expressions such as function arguments.</p>
<ul>
<li><a class="el" href="group__all__public.html#gaaaf15101ec60ce66e80737375baa7391">Apop_col_t</a> </li>
<li><a class="el" href="group__all__public.html#ga7d87af4e65acbf6982a34cf3dc33eae6">Apop_row_t</a> </li>
<li><a class="el" href="group__all__public.html#gad56ce572c7489820777290153ab7d87b">Apop_col_tv</a> </li>
<li><a class="el" href="group__all__public.html#ga6396c26f1d47cced2be3a761185d3b35">Apop_row_tv</a> </li>
<li><a class="el" href="group__all__public.html#ga9abee86763f92d505fd4fb792f06fd7c">Apop_matrix_row</a> </li>
<li><a class="el" href="group__all__public.html#ga3e7f99e26eb4d5d5438fd5fa16fcadde">Apop_matrix_col</a></li>
</ul>
<p>The view is an automatic variable, not a pointer, and therefore disappears at the end of the scope in which it is declared. If you want to retain the data after the function exits, copy it to another vector:</p>
<div class="fragment"><div class="line"><a class="code" href="group__all__public.html#ga9abee86763f92d505fd4fb792f06fd7c">Apop_matrix_row</a>(d-&gt;matrix, 2, rowtwo);</div>
<div class="line"><span class="keywordflow">return</span> <a class="code" href="group__all__public.html#ga5baf0e8717a30fdcfba350da904c1825">apop_vector_copy</a>(rowtwo);</div>
</div><!-- fragment --><p>Curly braces always delimit scope, not just at the end of a function. These macros work by generating a number of local variables, which you may be able to see in your debugger. When program evaluation exits a given block, all variables in that block are erased. Here is some sample code that won't work:</p>
<div class="fragment"><div class="line"><a class="code" href="structapop__data.html">apop_data</a> *outdata;</div>
<div class="line"><span class="keywordflow">if</span> (get_odd){</div>
<div class="line">    outdata = <a class="code" href="group__all__public.html#ga401dbc60c9915be8e4c4def68b22d755">Apop_r</a>(data, 1);</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    outdata = <a class="code" href="group__all__public.html#ga401dbc60c9915be8e4c4def68b22d755">Apop_r</a>(data, 0);</div>
<div class="line">}</div>
<div class="line">apop_data_show(outdata); <span class="comment">//breaks: outdata points to out-of-scope variables.</span></div>
</div><!-- fragment --><p>For this if/then statement, there are two sets of local variables generated: one for the <code>if</code> block, and one for the <code>else</code> block. By the last line, neither exists. You can get around the problem here by making sure to not put the macro declaring new variables in a block. E.g.:</p>
<div class="fragment"><div class="line"><a class="code" href="structapop__data.html">apop_data</a> *outdata = <a class="code" href="group__all__public.html#ga401dbc60c9915be8e4c4def68b22d755">Apop_r</a>(data, get_odd ? 1 : 0);</div>
<div class="line">apop_data_show(outdata);</div>
</div><!-- fragment --><p>This is a general rule about how variables declared in blocks will behave, but because the macros obscure the variable declarations, it is worth watching out for here.</p>
<h1><a class="anchor" id="data_set_get"></a>
Set/get</h1>
<p>First, some examples:</p>
<div class="fragment"><div class="line"><a class="code" href="structapop__data.html">apop_data</a> *d = <a class="code" href="group__all__public.html#gac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(10, 10, 10);</div>
<div class="line"><a class="code" href="group__all__public.html#gae32d4f48cff7788b617d40155703ae64">apop_name_add</a>(d-&gt;names, <span class="stringliteral">&quot;Zeroth row&quot;</span>, <span class="charliteral">&#39;r&#39;</span>);</div>
<div class="line"><a class="code" href="group__all__public.html#gae32d4f48cff7788b617d40155703ae64">apop_name_add</a>(d-&gt;names, <span class="stringliteral">&quot;Zeroth col&quot;</span>, <span class="charliteral">&#39;c&#39;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">//set cell at row=8 col=0 to value=27</span></div>
<div class="line"><a class="code" href="group__all__public.html#ga5bdc618669b9ddc8239595d7b50bec9e">apop_data_set</a>(d, 8, 0, .val=27);</div>
<div class="line">assert(<a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(d, 8, .colname=<span class="stringliteral">&quot;Zeroth&quot;</span>) == 27);</div>
<div class="line"><span class="keywordtype">double</span> *x = <a class="code" href="group__all__public.html#ga59d1c0299c7eb87224bc6c60555784fe">apop_data_ptr</a>(d, .col=7, .rowname=<span class="stringliteral">&quot;Zeroth&quot;</span>);</div>
<div class="line">*x = 270;</div>
<div class="line">assert(<a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(d, 0, 7) == 270);</div>
<div class="line"></div>
<div class="line"><span class="comment">// This is invalid---the value doesn&#39;t follow the colname. Use .val=5.</span></div>
<div class="line"><span class="comment">// apop_data_set(d, .row = 3, .colname=&quot;Column 8&quot;, 5);  </span></div>
<div class="line"></div>
<div class="line"><span class="comment">// OK, to set (3, 8) to 5:</span></div>
<div class="line"><a class="code" href="group__all__public.html#ga5bdc618669b9ddc8239595d7b50bec9e">apop_data_set</a>(d, 3, 8, 5);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//apop_data set holding a scalar:</span></div>
<div class="line"><a class="code" href="structapop__data.html">apop_data</a> *s = <a class="code" href="group__all__public.html#gac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(1);</div>
<div class="line"><a class="code" href="group__all__public.html#ga5bdc618669b9ddc8239595d7b50bec9e">apop_data_set</a>(s, .val=12);</div>
<div class="line">assert(<a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(s) == 12);</div>
<div class="line"></div>
<div class="line"><span class="comment">//apop_data set holding a vector:</span></div>
<div class="line"><a class="code" href="structapop__data.html">apop_data</a> *v = <a class="code" href="group__all__public.html#gac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(12);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; 12; i++) <a class="code" href="group__all__public.html#ga5bdc618669b9ddc8239595d7b50bec9e">apop_data_set</a>(s, i, .val=i*10);</div>
<div class="line">assert(<a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(s,3) == 30);</div>
<div class="line"></div>
<div class="line"><span class="comment">//This is a common form from pulling from a list of named scalars, </span></div>
<div class="line"><span class="comment">//produced via apop_data_add_named_elmt</span></div>
<div class="line"><span class="keywordtype">double</span> AIC = <a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(your_model-&gt;info, .rowname=<span class="stringliteral">&quot;AIC&quot;</span>);</div>
</div><!-- fragment --><p>Some additional notes:</p>
<ul>
<li>The versions that take a column/row name use <a class="el" href="group__all__public.html#gadb1398925a93b7c2c502af8fb2abc49e">apop_name_find</a> for the search; see notes there on the name matching rules. </li>
<li>For those that take a column number, column -1 is the vector element. </li>
<li>For those that take a column name, I will search the vector last&mdash;if I don't find the name among the matrix columns, but the name matches the vector name, I return column -1. </li>
<li>If you give me both a <code></code>.row and a <code></code>.rowname, I go with the name; similarly for <code></code>.col and <code></code>.colname. </li>
<li>You can give me the name of a page, e.g. <div class="fragment"><div class="line"><span class="keywordtype">double</span> AIC = <a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(data, .rowname=<span class="stringliteral">&quot;AIC&quot;</span>, .col=-1, .page=<span class="stringliteral">&quot;&lt;Info&gt;&quot;</span>);</div>
</div><!-- fragment --></li>
</ul>
<ul>
<li>Numeric values default to zero, which is how the examples above that treated the <a class="el" href="gentle.html#apop_data">apop_data</a> set as a vector or scalar could do so relatively gracefully.</li>
</ul>
<ul>
<li>Thus, so <code>apop_data_get(dataset, 1)</code> gets item (1, 0) from the matrix element of <code>dataset</code>. But as a do-what-I-mean exception, if there is no matrix element but there is a vector, then this form will get vector element 1. Relying on this DWIM exception is useful iff you can guarantee that a data set will have only a vector or a matrix but not both. Otherwise, be explicit and use <code>apop_data_get(dataset, 1, -1)</code>.</li>
</ul>
<p>The <a class="el" href="group__all__public.html#ga59d1c0299c7eb87224bc6c60555784fe">apop_data_ptr</a> function follows the lead of <code>gsl_vector_ptr</code> and <code>gsl_matrix_ptr</code>, and like those functions, returns a pointer to the appropriate <code>double</code>.</p>
<ul>
<li><a class="el" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a> </li>
<li><a class="el" href="group__all__public.html#ga5bdc618669b9ddc8239595d7b50bec9e">apop_data_set</a> </li>
<li><a class="el" href="group__all__public.html#ga59d1c0299c7eb87224bc6c60555784fe">apop_data_ptr</a> : returns a pointer to the element. </li>
<li><a class="el" href="group__all__public.html#ga044771db76f0afb410a8d4f05ac51ca3">apop_data_get_page</a> : retrieve a named page from a data set. If you only need a few items, you can specify a page name to <code>apop_data_</code>(get|set|ptr). <pre class="fragment">See also:
</pre></li>
</ul>
<ul>
<li><code>double gsl_matrix_get (const gsl_matrix * m, size_t i, size_t j)</code> </li>
<li><code>double gsl_vector_get (const gsl_vector * v, size_t i)</code> </li>
<li><code>void gsl_matrix_set (gsl_matrix * m, size_t i, size_t j, double x)</code> </li>
<li><code>void gsl_vector_set (gsl_vector * v, size_t i, double x)</code> </li>
<li><code>double * gsl_matrix_ptr (gsl_matrix * m, size_t i, size_t j)</code> </li>
<li><code>double * gsl_vector_ptr (gsl_vector * v, size_t i)</code> </li>
<li><code>const double * gsl_matrix_const_ptr (const gsl_matrix * m, size_t i, size_t j)</code> </li>
<li><code>const double * gsl_vector_const_ptr (const gsl_vector * v, size_t i)</code> </li>
<li><code>gsl_matrix_get_row (gsl_vector * v, const gsl_matrix * m, size_t i)</code> </li>
<li><code>gsl_matrix_get_col (gsl_vector * v, const gsl_matrix * m, size_t j)</code> </li>
<li><code>gsl_matrix_set_row (gsl_matrix * m, size_t i, const gsl_vector * v)</code> </li>
<li><code>gsl_matrix_set_col (gsl_matrix * m, size_t j, const gsl_vector * v)</code></li>
</ul>
<h1><a class="anchor" id="mapply"></a>
Map/apply</h1>
<p><a class="anchor" id="outline_mapply"></a>These functions allow you to send each element of a vector or matrix to a function, either producing a new matrix (map) or transforming the original (apply). The <code></code>..._sum functions return the sum of the mapped output.</p>
<p>There are two types, which were developed at different times. The <a class="el" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a> and <a class="el" href="group__all__public.html#ga30601e357a1e21648f8d8db3c9ed6f3a">apop_map_sum</a> functions use variadic function inputs to cover a lot of different types of process depending on the inputs. Other functions with types in their names, like <a class="el" href="group__all__public.html#ga5da5091a11c37d3501d678b8ecec466f">apop_matrix_map</a> and <a class="el" href="group__all__public.html#ga51964750c64d327e52e2230019e44f66">apop_vector_apply</a>, may be easier to use in some cases. They use the same routines internally, so use whichever type is convenient.</p>
<p>You can do many things quickly with these functions.</p>
<p>Get the sum of squares of a vector's elements:</p>
<div class="fragment"><div class="line">  <span class="comment">//given apop_data *dataset and gsl_vector *v:</span></div>
<div class="line"><span class="keywordtype">double</span> sum_of_squares = <a class="code" href="group__all__public.html#ga30601e357a1e21648f8d8db3c9ed6f3a">apop_map_sum</a>(dataset, gsl_pow_2);</div>
<div class="line"><span class="keywordtype">double</span> sum_of_sqvares = <a class="code" href="group__all__public.html#gaa1a135fcdd8ea6f9cbc0d518773d6c3c">apop_vector_map_sum</a>(v, gsl_pow_2);</div>
</div><!-- fragment --><p>Here, we create an index vector [ <img class="formulaInl" alt="$0, 1, 2, ...$" src="form_100.png"/>].</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> index(<span class="keywordtype">double</span> in, <span class="keywordtype">int</span> index){<span class="keywordflow">return</span> index;}</div>
<div class="line"><a class="code" href="structapop__data.html">apop_data</a> *d = <a class="code" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(<a class="code" href="group__all__public.html#gac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(100), .fn_di=index, .inplace=<span class="charliteral">&#39;y&#39;</span>);</div>
</div><!-- fragment --><p>Given your log likelihood function, which acts on a <a class="el" href="gentle.html#apop_data">apop_data</a> set with only one row, and a data set where each row of the matrix is an observation, find the total log likelihood via:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> your_log_likelihood_fn(<a class="code" href="structapop__data.html">apop_data</a> * in)</div>
<div class="line">     {[your math goes here]}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> total_ll = <a class="code" href="group__all__public.html#ga30601e357a1e21648f8d8db3c9ed6f3a">apop_map_sum</a>(dataset, .fn_r=your_log_likelihood_fn);</div>
</div><!-- fragment --><p>How many missing elements are there in your data matrix?</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> nan_check(<span class="keyword">const</span> <span class="keywordtype">double</span> in){ <span class="keywordflow">return</span> isnan(in);}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> missing_ct = <a class="code" href="group__all__public.html#ga30601e357a1e21648f8d8db3c9ed6f3a">apop_map_sum</a>(in, nan_check, .part=<span class="charliteral">&#39;m&#39;</span>);</div>
</div><!-- fragment --><p>Get the mean of the not-NaN elements of a data set:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> no_nan_val(<span class="keyword">const</span> <span class="keywordtype">double</span> in){ <span class="keywordflow">return</span> isnan(in)? 0 : in;}</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> not_nan_check(<span class="keyword">const</span> <span class="keywordtype">double</span> in){ <span class="keywordflow">return</span> !isnan(in);}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> apop_mean_no_nans(<a class="code" href="structapop__data.html">apop_data</a> *in){</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__all__public.html#ga30601e357a1e21648f8d8db3c9ed6f3a">apop_map_sum</a>(in, no_nan_val)/<a class="code" href="group__all__public.html#ga30601e357a1e21648f8d8db3c9ed6f3a">apop_map_sum</a>(in, not_nan_check);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The following program randomly generates a data set where each row is a list of numbers with a different mean. It then finds the <img class="formulaInl" alt="$t$" src="form_43.png"/> statistic for each row, and the confidence with which we reject the claim that the statistic is less than or equal to zero.</p>
<p>Notice how the older <a class="el" href="group__all__public.html#ga51964750c64d327e52e2230019e44f66">apop_vector_apply</a> uses file-global variables to pass information into the functions, while the <a class="el" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a> uses a pointer to send parameters to the functions.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;apop.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> row_offset;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> offset_rng(<span class="keywordtype">double</span> *v){*v = gsl_rng_uniform(<a class="code" href="group__all__public.html#ga1e829ce2396bf05ab10460bcc37aeeab">apop_rng_get_thread</a>()) + row_offset;}</div>
<div class="line"><span class="keywordtype">double</span> find_tstat(gsl_vector *in){ <span class="keywordflow">return</span> <a class="code" href="group__all__public.html#ga7b0289d499a3dfa51a0c6fc689505cb5">apop_mean</a>(in)/sqrt(<a class="code" href="group__all__public.html#gae9308d562a120c8302edde3f736bc25d">apop_var</a>(in));}</div>
<div class="line"><span class="keywordtype">double</span> conf(<span class="keywordtype">double</span> in, <span class="keywordtype">void</span> *df){ <span class="keywordflow">return</span> gsl_cdf_tdist_P(in, *(<span class="keywordtype">int</span> *)df);}</div>
<div class="line"></div>
<div class="line"><span class="comment">//apop_vector_mean is a macro, so we can&#39;t point a pointer to it.</span></div>
<div class="line"><span class="keywordtype">double</span> mu(gsl_vector *in){ <span class="keywordflow">return</span> <a class="code" href="group__all__public.html#gab20e5ad95df0f24a1ea06294695031a8">apop_vector_mean</a>(in);}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *d = <a class="code" href="group__all__public.html#gac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(10, 100);</div>
<div class="line">    gsl_rng *r = <a class="code" href="group__all__public.html#gada044cf02135422a9f9292b6054c86dd">apop_rng_alloc</a>(3242);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; 10; i++){</div>
<div class="line">        row_offset = gsl_rng_uniform(r)*2 -1; <span class="comment">//declared and used above.</span></div>
<div class="line">        Apop_row_v(d, i, onerow);</div>
<div class="line">        <a class="code" href="group__all__public.html#ga51964750c64d327e52e2230019e44f66">apop_vector_apply</a>(onerow, offset_rng);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">size_t</span> df = d-&gt;matrix-&gt;size2-1;</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *means = <a class="code" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(d, .fn_v = mu, .part =<span class="charliteral">&#39;r&#39;</span>);</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *tstats = <a class="code" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(d, .fn_v = find_tstat, .part =<span class="charliteral">&#39;r&#39;</span>);</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *confidences = <a class="code" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(tstats, .fn_dp = conf, .param = &amp;df);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef Testing</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;means:\n&quot;</span>); apop_data_show(means);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nt stats:\n&quot;</span>); apop_data_show(tstats);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nconfidences:\n&quot;</span>); apop_data_show(confidences);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//Some sanity checks, for Apophenia&#39;s test suite.</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; 10; i++){</div>
<div class="line">        <span class="comment">//sign of mean == sign of t stat.</span></div>
<div class="line">        assert(<a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(means, i, -1) * <a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(tstats, i, -1) &gt;=0);</div>
<div class="line"></div>
<div class="line">        <span class="comment">//inverse of P-value should be the t statistic.</span></div>
<div class="line">        assert(fabs(gsl_cdf_tdist_Pinv(<a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(confidences, i, -1),100) </div>
<div class="line">                    - <a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(tstats, i, -1) &lt; 1e-3));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>One more toy example, demonstrating the use of <a class="el" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a> and <a class="el" href="group__all__public.html#ga30601e357a1e21648f8d8db3c9ed6f3a">apop_map_sum</a> :</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;apop.h&gt;</span></div>
<div class="line"><span class="comment">/* This sample code sets the elements of a data set&#39;s vector to one</span></div>
<div class="line"><span class="comment">   if the index is even.  Then, via the weights vector, it adds up</span></div>
<div class="line"><span class="comment">   the even indices.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">   There is really no need to use the weights vector; this code</span></div>
<div class="line"><span class="comment">   snippet is an element of Apophenia&#39;s test suite, and goes the long</span></div>
<div class="line"><span class="comment">   way to test that the weights are correctly handled. */</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> set_vector_to_even(<a class="code" href="structapop__data.html">apop_data</a> * r, <span class="keywordtype">int</span> index){</div>
<div class="line">    <a class="code" href="group__all__public.html#ga5bdc618669b9ddc8239595d7b50bec9e">apop_data_set</a>(r, 0, -1, .val=1-(index %2));</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> set_weight_to_index(<a class="code" href="structapop__data.html">apop_data</a> * r, <span class="keywordtype">int</span> index){ </div>
<div class="line">    gsl_vector_set(r-&gt;weights, 0, index); </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> weight_given_even(<a class="code" href="structapop__data.html">apop_data</a> *r){ </div>
<div class="line">    <span class="keywordflow">return</span> gsl_vector_get(r-&gt;vector, 0) ? gsl_vector_get(r-&gt;weights, 0) : 0; </div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *d = <a class="code" href="group__all__public.html#gac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(100);</div>
<div class="line">    d-&gt;weights = gsl_vector_alloc(100);</div>
<div class="line">    <a class="code" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(d, .fn_ri=set_vector_to_even, .inplace=<span class="charliteral">&#39;v&#39;</span>);</div>
<div class="line">    <a class="code" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(d, .fn_ri=set_weight_to_index, .inplace=<span class="charliteral">&#39;v&#39;</span>);</div>
<div class="line">    <span class="keywordtype">double</span> sum = <a class="code" href="group__all__public.html#ga30601e357a1e21648f8d8db3c9ed6f3a">apop_map_sum</a>(d, .fn_r = weight_given_even);</div>
<div class="line">    assert(sum == 49*25*2);</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li>If <code>apop_opts.thread_count</code> is greater than one, then the matrix will be broken into chunks and each sent to a different thread. Notice that the GSL is generally threadsafe, and SQLite is threadsafe conditional on several commonsense caveats that you'll find in the SQLite documentation. See <a class="el" href="group__all__public.html#ga1e829ce2396bf05ab10460bcc37aeeab">apop_rng_get_thread()</a> to use the GSL's RNGs in a threaded environment.</li>
</ul>
<ul>
<li>The <code></code>...sum functions are convenience functions that call <code></code>...map and then add up the contents. Thus, you will need to have adequate memory for the allocation of the temp matrix/vector.</li>
</ul>
<ul>
<li><a class="el" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a> </li>
<li><a class="el" href="group__all__public.html#ga30601e357a1e21648f8d8db3c9ed6f3a">apop_map_sum</a> </li>
<li><a class="el" href="group__all__public.html#ga5c4ae58b861199bbc1a460719942d98f">apop_matrix_apply</a> </li>
<li><a class="el" href="group__all__public.html#ga5da5091a11c37d3501d678b8ecec466f">apop_matrix_map</a> </li>
<li><a class="el" href="group__all__public.html#gae04bc576579bfb2e14d5004d4af7bb88">apop_matrix_map_all_sum</a> </li>
<li><a class="el" href="group__all__public.html#ga4f0c51a046140b563c8e12a6032e9a16">apop_matrix_map_sum</a> </li>
<li><a class="el" href="group__all__public.html#ga51964750c64d327e52e2230019e44f66">apop_vector_apply</a> </li>
<li><a class="el" href="group__all__public.html#gaf30eadf8772ecb9a2689ddf104902ea4">apop_vector_map</a> </li>
<li><a class="el" href="group__all__public.html#gaa1a135fcdd8ea6f9cbc0d518773d6c3c">apop_vector_map_sum</a></li>
</ul>
<h1><a class="anchor" id="matrixmathtwo"></a>
Basic Math</h1>
<ul>
<li><a class="el" href="group__all__public.html#ga032dcecb67155c527c884dd2c1cc6a6e">apop_vector_exp</a> : exponentiate every element of a vector </li>
<li><a class="el" href="group__all__public.html#ga5a622b8360eba63795a6049c30ac54a2">apop_vector_log</a> : take the natural log of every element of a vector </li>
<li><a class="el" href="group__all__public.html#ga1a4a67e0b0bec8205cfe75bd3786c30e">apop_vector_log10</a> : take the log (base 10) of every element of a vector </li>
<li><a class="el" href="group__all__public.html#ga44a77f5e6867c627fd313f3f6e252ff8">apop_vector_distance</a> : find the distance between two vectors via various metrics </li>
<li><a class="el" href="group__all__public.html#ga194ad92b1bc632ba1d13d9958c7b5b4d">apop_vector_normalize</a> : scale/shift a matrix to have mean zero, sum to one, have a range of exactly $[0, 1]$, et cetera </li>
<li><a class="el" href="group__all__public.html#gabd5c77978dc6972e4ba52f77fb8dfef0">apop_vector_entropy</a> : calculate the entropy of a vector of frequencies or probabilities <pre class="fragment">See also:
</pre></li>
</ul>
<ul>
<li><code>int gsl_matrix_add (gsl_matrix * a, const gsl_matrix * b)</code> </li>
<li><code>int gsl_matrix_sub (gsl_matrix * a, const gsl_matrix * b)</code> </li>
<li><code>int gsl_matrix_mul_elements (gsl_matrix * a, const gsl_matrix * b)</code> </li>
<li><code>int gsl_matrix_div_elements (gsl_matrix * a, const gsl_matrix * b)</code> </li>
<li><code>int gsl_matrix_scale (gsl_matrix * a, const double x)</code> </li>
<li><code>int gsl_matrix_add_constant (gsl_matrix * a, const double x)</code> </li>
<li><code>gsl_vector_add (gsl_vector * a, const gsl_vector * b)</code> </li>
<li><code>gsl_vector_sub (gsl_vector * a, const gsl_vector * b)</code> </li>
<li><code>gsl_vector_mul (gsl_vector * a, const gsl_vector * b)</code> </li>
<li><code>gsl_vector_div (gsl_vector * a, const gsl_vector * b)</code> </li>
<li><code>gsl_vector_scale (gsl_vector * a, const double x)</code> </li>
<li><code>gsl_vector_add_constant (gsl_vector * a, const double x)</code></li>
</ul>
<h1><a class="anchor" id="matrixmath"></a>
Matrix math</h1>
<ul>
<li><a class="el" href="group__all__public.html#gaf2d13e1b1f20f97e0772a0be41dc430e">apop_dot</a> : matrix <img class="formulaInl" alt="$\cdot$" src="form_28.png"/> matrix, matrix <img class="formulaInl" alt="$\cdot$" src="form_28.png"/> vector, or vector <img class="formulaInl" alt="$\cdot$" src="form_28.png"/> matrix </li>
<li><a class="el" href="group__all__public.html#ga03038130e4ba55228f9e164dba513961">apop_matrix_determinant</a> </li>
<li><a class="el" href="group__all__public.html#ga185243be2d8a93686c68263cc3318f47">apop_matrix_inverse</a> </li>
<li><a class="el" href="group__all__public.html#ga6984006ab44fa7c9c2e99463f7d4081b">apop_det_and_inv</a> : find determinant and inverse at the same time</li>
</ul>
<p>See the GSL documentation for voluminous further options.</p>
<h1><a class="anchor" id="sumstats"></a>
Summary stats</h1>
<ul>
<li><a class="el" href="group__all__public.html#ga253dba4ed7f5c03107d38c1268b46c01">apop_data_summarize</a> </li>
<li><a class="el" href="group__all__public.html#ga61185af7877b709c8b257b342c24edbc">apop_vector_moving_average</a> </li>
<li><a class="el" href="group__all__public.html#gafb838084f967543fa8a03e460180d53b">apop_vector_percentiles</a> </li>
<li><a class="el" href="group__all__public.html#ga136ded2b6d190739deca064701cf5ca1">apop_vector_bounded</a> <pre class="fragment">    See also:
</pre></li>
</ul>
<ul>
<li><code>double gsl_matrix_max (const gsl_matrix * m)</code> </li>
<li><code>double gsl_matrix_min (const gsl_matrix * m)</code> </li>
<li><code>void gsl_matrix_minmax (const gsl_matrix * m, double * min_out, double * max_out)</code> </li>
<li><code>void gsl_matrix_max_index (const gsl_matrix * m, size_t * imax, size_t * jmax)</code> </li>
<li><code>void gsl_matrix_min_index (const gsl_matrix * m, size_t * imin, size_t * jmin)</code> </li>
<li><code>void gsl_matrix_minmax_index (const gsl_matrix * m, size_t * imin, size_t * jmin, size_t * imax, size_t * jmax)</code> </li>
<li><code>gsl_vector_max (const gsl_vector * v)</code> </li>
<li><code>gsl_vector_min (const gsl_vector * v)</code> </li>
<li><code>gsl_vector_minmax (const gsl_vector * v, double * min_out, double * max_out)</code> </li>
<li><code>gsl_vector_max_index (const gsl_vector * v)</code> </li>
<li><code>gsl_vector_min_index (const gsl_vector * v)</code> </li>
<li><code>gsl_vector_minmax_index (const gsl_vector * v, size_t * imin, size_t * imax)</code></li>
</ul>
<h1><a class="anchor" id="moments"></a>
Moments</h1>
<p>For most of these, you can add a weights vector for weighted mean/var/cov/..., such as <code>apop_vector_mean(d-&gt;vector, .weights=d-&gt;weights)</code></p>
<ul>
<li><a class="el" href="group__all__public.html#ga7b0289d499a3dfa51a0c6fc689505cb5">apop_mean</a> : the first three with short names operate on a vector. </li>
<li><a class="el" href="group__all__public.html#ga9b05181ceec857e9eb9ed6a8ea7423d3">apop_sum</a> </li>
<li><a class="el" href="group__all__public.html#gae9308d562a120c8302edde3f736bc25d">apop_var</a> </li>
<li><a class="el" href="group__all__public.html#ga369c774aac917e56d8e32f9c66d9c2a0">apop_matrix_sum</a> </li>
<li><a class="el" href="group__all__public.html#gafa3ab967f57f8ad3cfb99a4a82cfae02">apop_data_correlation</a> </li>
<li><a class="el" href="group__all__public.html#gaeae37a5bf11cddee59e272b083a4efc7">apop_data_covariance</a> </li>
<li><a class="el" href="group__all__public.html#ga253dba4ed7f5c03107d38c1268b46c01">apop_data_summarize</a> </li>
<li><a class="el" href="group__all__public.html#ga040b9e9fea1abe105de86081bf396d40">apop_matrix_mean</a> </li>
<li><a class="el" href="group__all__public.html#gaf794cc2491ef147e0c67eb05feed7a87">apop_matrix_mean_and_var</a> </li>
<li><a class="el" href="group__all__public.html#ga105323d45e054e608d284e7efb9c0950">apop_vector_correlation</a> </li>
<li><a class="el" href="group__all__public.html#ga7c0881e9b640f6c6448014f44f5ac1f5">apop_vector_cov</a> </li>
<li><a class="el" href="group__all__public.html#gaf5740c698174b1a265d182f4af1c0252">apop_vector_kurtosis</a> </li>
<li><a class="el" href="group__all__public.html#gaabe3183e8a6a496f3fd6ab316687381e">apop_vector_kurtosis_pop</a> </li>
<li><a class="el" href="group__all__public.html#gab20e5ad95df0f24a1ea06294695031a8">apop_vector_mean</a> </li>
<li><a class="el" href="group__all__public.html#gac9d269f1dc62b038c0da72085cac1c28">apop_vector_skew</a> </li>
<li><a class="el" href="group__all__public.html#gafb284d668d567de4810620962043f827">apop_vector_skew_pop</a> </li>
<li><a class="el" href="group__all__public.html#gaf6182181dd424bc4de98b4bfbd349b4e">apop_vector_sum</a> </li>
<li><a class="el" href="group__all__public.html#gadcc397ab90933d79b3062206301a0aa0">apop_vector_var</a> </li>
<li><a class="el" href="group__all__public.html#ga2446385225c68c62ade26402c63600a4">apop_vector_var_m</a></li>
</ul>
<h1><a class="anchor" id="convsec"></a>
Conversion among types</h1>
<p>There are no functions provided to convert from <a class="el" href="gentle.html#apop_data">apop_data</a> to the constituent elements, because you don't need a function.</p>
<p>If you need an individual element, you can use its pointer to retrieve it:</p>
<div class="fragment"><div class="line"><a class="code" href="structapop__data.html">apop_data</a> *d = <a class="code" href="group__all__public.html#ga1f06db34e05b5afb63112f83ad2317b8">apop_query_to_mixed_data</a>(<span class="stringliteral">&quot;vmmw&quot;</span>, <span class="stringliteral">&quot;select result, age, &quot;</span></div>
<div class="line">                                     <span class="stringliteral">&quot;income, replicate_weight from data&quot;</span>);</div>
<div class="line"><span class="keywordtype">double</span> avg_result = <a class="code" href="group__all__public.html#gab20e5ad95df0f24a1ea06294695031a8">apop_vector_mean</a>(d-&gt;vector, .weights=d-&gt;weights);</div>
</div><!-- fragment --><p>In the other direction, you can use compound literals to wrap an <a class="el" href="gentle.html#apop_data">apop_data</a> struct around a loose vector or matrix:</p>
<div class="fragment"><div class="line"><span class="comment">//Given:</span></div>
<div class="line">gsl_vector *v;</div>
<div class="line">gsl_matrix *m;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Then this form wraps the elements into apop_data structs. Note that</span></div>
<div class="line"><span class="comment">// these are not pointers: they&#39;re automatically allocated and therefore</span></div>
<div class="line"><span class="comment">// the extra memory use for the wrapper is cleaned up on exit from scope.</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="structapop__data.html">apop_data</a> *dv = &amp;(<a class="code" href="group__all__public.html#ga0c8c2a99fb8c6ec54822aca08591545e">apop_data</a>){.vector=v}; </div>
<div class="line"><a class="code" href="structapop__data.html">apop_data</a> *dm = &amp;(<a class="code" href="group__all__public.html#ga0c8c2a99fb8c6ec54822aca08591545e">apop_data</a>){.matrix=m};</div>
<div class="line"></div>
<div class="line"><a class="code" href="structapop__data.html">apop_data</a> *v_dot_m = <a class="code" href="group__all__public.html#gaf2d13e1b1f20f97e0772a0be41dc430e">apop_dot</a>(dv, dm);</div>
<div class="line"></div>
<div class="line"><span class="comment">//Here is a macro to hide C&#39;s ugliness:</span></div>
<div class="line"><span class="preprocessor">#define As_data(...) (&amp;(apop_data){__VA_ARGS__})</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="structapop__data.html">apop_data</a> *v_dot_m2 = <a class="code" href="group__all__public.html#gaf2d13e1b1f20f97e0772a0be41dc430e">apop_dot</a>(As_data(.vector=v), As_data(.matrix=m));</div>
<div class="line"></div>
<div class="line"><span class="comment">//The wrapped object is an automatically-allocated structure pointing to the</span></div>
<div class="line"><span class="comment">//original data. If it needs to persist or be separate from the original,</span></div>
<div class="line"><span class="comment">//make a copy:</span></div>
<div class="line"><a class="code" href="structapop__data.html">apop_data</a> *dm_copy = <a class="code" href="group__all__public.html#gadd67e6838ce2521a1d756894dc9b5ccf">apop_data_copy</a>(As_data(.vector=v, .matrix=m));</div>
</div><!-- fragment --><ul>
<li><a class="el" href="group__all__public.html#ga8abdcdbaceaaf0dd3882a164bc2565de">apop_array_to_vector</a> : <code>double*</code> <img class="formulaInl" alt="$\to$" src="form_40.png"/> <code>gsl_vector</code> </li>
<li><a class="el" href="group__all__public.html#gad6be56d710a63aa1ceadf2242c553905">apop_data_fill</a> : <code>double*</code> <img class="formulaInl" alt="$\to$" src="form_40.png"/> <a class="el" href="gentle.html#apop_data">apop_data</a>. </li>
<li><a class="el" href="group__all__public.html#gacb6b2c53478f9db902ba0340ba499819">apop_data_falloc</a> : macro to allocate and fill a <a class="el" href="gentle.html#apop_data">apop_data</a> set. </li>
<li><a class="el" href="group__all__public.html#ga630de5d4fcbe9ef13373029f5d813a97">apop_text_to_data</a> : delimited text file <img class="formulaInl" alt="$\to$" src="form_40.png"/> <a class="el" href="gentle.html#apop_data">apop_data</a> </li>
<li><a class="el" href="group__all__public.html#gabd00e16791a970631c3ed4ac3487da46">apop_text_to_db</a> : delimited text file <img class="formulaInl" alt="$\to$" src="form_40.png"/> database </li>
<li><a class="el" href="group__all__public.html#ga604388dc6d7d08d95bbaa4422085db9c">apop_vector_to_matrix</a></li>
</ul>
<h1><a class="anchor" id="names"></a>
Name handling</h1>
<p>If you generate your data set via <a class="el" href="group__all__public.html#ga630de5d4fcbe9ef13373029f5d813a97">apop_text_to_data</a> or from the database via <a class="el" href="group__all__public.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> (or <a class="el" href="group__all__public.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a> or <a class="el" href="group__all__public.html#ga1f06db34e05b5afb63112f83ad2317b8">apop_query_to_mixed_data</a>) then column names appear as expected. Set <code>apop_opts.db_name_column</code> to the name of a column in your query result to use that column name for row names.</p>
<p>Sample uses, given <a class="el" href="gentle.html#apop_data">apop_data</a> set <code>d</code>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> row_name_count = d-&gt;names-&gt;rowct</div>
<div class="line"><span class="keywordtype">int</span> col_name_count = d-&gt;names-&gt;colct</div>
<div class="line"><span class="keywordtype">int</span> text_name_count = d-&gt;names-&gt;textct</div>
<div class="line"></div>
<div class="line"><span class="comment">//Manually add names in sequence:</span></div>
<div class="line"><a class="code" href="group__all__public.html#gae32d4f48cff7788b617d40155703ae64">apop_name_add</a>(d-&gt;names, <span class="stringliteral">&quot;the vector&quot;</span>, <span class="charliteral">&#39;v&#39;</span>);</div>
<div class="line"><a class="code" href="group__all__public.html#gae32d4f48cff7788b617d40155703ae64">apop_name_add</a>(d-&gt;names, <span class="stringliteral">&quot;row 0&quot;</span>, <span class="charliteral">&#39;r&#39;</span>);</div>
<div class="line"><a class="code" href="group__all__public.html#gae32d4f48cff7788b617d40155703ae64">apop_name_add</a>(d-&gt;names, <span class="stringliteral">&quot;row 1&quot;</span>, <span class="charliteral">&#39;r&#39;</span>);</div>
<div class="line"><a class="code" href="group__all__public.html#gae32d4f48cff7788b617d40155703ae64">apop_name_add</a>(d-&gt;names, <span class="stringliteral">&quot;row 2&quot;</span>, <span class="charliteral">&#39;r&#39;</span>);</div>
<div class="line"><a class="code" href="group__all__public.html#gae32d4f48cff7788b617d40155703ae64">apop_name_add</a>(d-&gt;names, <span class="stringliteral">&quot;numeric column 0&quot;</span>, <span class="charliteral">&#39;c&#39;</span>);</div>
<div class="line"><a class="code" href="group__all__public.html#gae32d4f48cff7788b617d40155703ae64">apop_name_add</a>(d-&gt;names, <span class="stringliteral">&quot;text column 0&quot;</span>, <span class="charliteral">&#39;t&#39;</span>);</div>
<div class="line"><a class="code" href="group__all__public.html#gae32d4f48cff7788b617d40155703ae64">apop_name_add</a>(d-&gt;names, <span class="stringliteral">&quot;The name of the data set.&quot;</span>, <span class="charliteral">&#39;h&#39;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">//or append several names at once</span></div>
<div class="line"><a class="code" href="group__all__public.html#gaeca6159c82c21da0db82ae9ed0582dc6">apop_data_add_names</a>(d, <span class="charliteral">&#39;c&#39;</span>, <span class="stringliteral">&quot;numeric column 1&quot;</span>, <span class="stringliteral">&quot;numeric column 2&quot;</span>, <span class="stringliteral">&quot;numeric column 3&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">//point to element i from the row/col/text names:</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">char</span> *rowname_i = d-&gt;names-&gt;row[i];</div>
<div class="line"><span class="keywordtype">char</span> *colname_i = d-&gt;names-&gt;col[i];</div>
<div class="line"><span class="keywordtype">char</span> *textname_i = d-&gt;names-&gt;text[i];</div>
<div class="line"></div>
<div class="line"><span class="comment">//The vector also has a name:</span></div>
<div class="line"><span class="keywordtype">char</span> *vname = d-&gt;names-&gt;vector;</div>
</div><!-- fragment --><ul>
<li><a class="el" href="group__all__public.html#gae32d4f48cff7788b617d40155703ae64">apop_name_add</a> : add one name </li>
<li><a class="el" href="group__all__public.html#gaeca6159c82c21da0db82ae9ed0582dc6">apop_data_add_names</a> : add a sequence of names at once </li>
<li><a class="el" href="group__all__public.html#gab4fd369dba75ec4782400cf7378e56ec">apop_name_stack</a> : copy the contents of one name list to another </li>
<li><a class="el" href="group__all__public.html#gadb1398925a93b7c2c502af8fb2abc49e">apop_name_find</a> : find the row/col number for a given name. </li>
<li><a class="el" href="group__all__public.html#gaf7220e4b2fe43c56593af0ceb2c7001a">apop_name_print</a> : print the <a class="el" href="structapop__name.html">apop_name</a> struct, for diagnostic purposes.</li>
</ul>
<h1><a class="anchor" id="textsec"></a>
Text data</h1>
<p>The <a class="el" href="gentle.html#apop_data">apop_data</a> set includes a grid of strings, <code>text</code>, for holding text data.</p>
<p>Text should be encoded in UTF-8. ASCII is a subset of UTF-8, so that's OK too.</p>
<p>There are a few simple forms for handling the <code>text</code> element of an <code><a class="el" href="structapop__data.html">apop_data</a></code> set, which handle the tedium of memory-handling for you.</p>
<ul>
<li>Use <a class="el" href="group__all__public.html#ga9fba0f07c262a433133f6f3362617da3">apop_text_alloc</a> to allocate the block of text. It is actually a realloc function, which you can use to resize an existing block without leaks. </li>
<li>Use <a class="el" href="group__all__public.html#gae987ac014cda5e483f8c16bfd59147ae">apop_text_set</a> to write text elements. It replaces any existing text in the given slot without memory leaks. </li>
<li>The number of rows of text data in <code>tdata</code> is <code>tdata-&gt;textsize[0]</code>; the number of columns is <code>tdata-&gt;textsize[1]</code>. </li>
<li>Refer to individual elements using the usual 2-D array notation, <code>tdata-&gt;text[row][col]</code>. </li>
<li><code>x[0]</code> can always be written as <code>*x</code>, which may save some typing. The number of rows is <code>*tdata-&gt;textsize</code>. If you have a single column of text data (i.e., all data is in column zero), then item <code>i</code> is <code>*tdata-&gt;text[i]</code>. If you know you have exactly one cell of text, then its value is <code>**tdata-&gt;text</code>. </li>
<li>After <a class="el" href="group__all__public.html#ga9fba0f07c262a433133f6f3362617da3">apop_text_alloc</a>, all elements are the empty string <code>""</code>, which you can check via <code>if (!strlen(dataset-&gt;text[i][j])) printf("&lt;blank&gt;")</code> or <code>if (!*dataset-&gt;text[i][j]) printf("&lt;blank&gt;")</code>. For the sake of efficiency when dealing with large, sparse data sets, all blank cells point to <em>the same</em> static empty string, meaning that freeing cells must be done with care. Your best bet is to rely on <a class="el" href="group__all__public.html#gae987ac014cda5e483f8c16bfd59147ae">apop_text_set</a>, <a class="el" href="group__all__public.html#ga9fba0f07c262a433133f6f3362617da3">apop_text_alloc</a>, and <a class="el" href="group__all__public.html#ga65386d7b37c2eaf37d1eb4e3ae7a7554">apop_text_free</a> to do the memory management for you.</li>
</ul>
<p>Here is a sample program that uses these forms, plus a few text-handling functions.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;apop.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <a class="code" href="group__all__public.html#ga02cf6319da103f9bfe55dfbbc7675536">apop_query</a>(<span class="stringliteral">&quot;create table data (name, city, state);&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;insert into data values (&#39;Mike Mills&#39;, &#39;Rockville&#39;, &#39;MD&#39;);&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;insert into data values (&#39;Bill Berry&#39;, &#39;Athens&#39;, &#39;GA&#39;);&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;insert into data values (&#39;Michael Stipe&#39;, &#39;Decatur&#39;, &#39;GA&#39;);&quot;</span>);</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *tdata = <a class="code" href="group__all__public.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a>(<span class="stringliteral">&quot;select name, city, state from data&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Customer #1: %s\n\n&quot;</span>, *tdata-&gt;text[0]);</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;The data, via apop_data_print:\n&quot;</span>);</div>
<div class="line">    <a class="code" href="group__all__public.html#gab45a848e5dbcaf82b5b95cd03f7b396a">apop_data_print</a>(tdata);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//the text alloc can be used as a text realloc:</span></div>
<div class="line">    <a class="code" href="group__all__public.html#ga9fba0f07c262a433133f6f3362617da3">apop_text_alloc</a>(tdata, 1+tdata-&gt;textsize[0], tdata-&gt;textsize[1]);</div>
<div class="line">    <a class="code" href="group__all__public.html#gae987ac014cda5e483f8c16bfd59147ae">apop_text_set</a>(tdata, *tdata-&gt;textsize-1, 0, <span class="stringliteral">&quot;Peter Buck&quot;</span>);</div>
<div class="line">    <a class="code" href="group__all__public.html#gae987ac014cda5e483f8c16bfd59147ae">apop_text_set</a>(tdata, *tdata-&gt;textsize-1, 1, <span class="stringliteral">&quot;Berkeley&quot;</span>);</div>
<div class="line">    <a class="code" href="group__all__public.html#gae987ac014cda5e483f8c16bfd59147ae">apop_text_set</a>(tdata, *tdata-&gt;textsize-1, 2, <span class="stringliteral">&quot;CA&quot;</span>);</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;\n\nAugmented data, printed via for loop:\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; tdata-&gt;textsize[0]; i++){</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt; tdata-&gt;textsize[1]; j++)</div>
<div class="line">            printf(<span class="stringliteral">&quot;%s\t&quot;</span>, tdata-&gt;text[i][j]);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *states = <a class="code" href="group__all__public.html#ga77c937ea4764d3da2ed9968273fa4544">apop_text_unique_elements</a>(tdata, 2);</div>
<div class="line">    <span class="keywordtype">char</span> *states_as_list = <a class="code" href="group__all__public.html#ga6270ad55c566140e0d7962cb4d5daacc">apop_text_paste</a>(states, .between=<span class="stringliteral">&quot;, &quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n States covered: %s\n&quot;</span>, states_as_list);</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li><a class="el" href="group__all__public.html#ga82281b8673cda3645054d7e061bb1167">apop_data_transpose()</a> : also transposes the text data. Say that you use <code>dataset = apop_query_to_text("select onecolumn from data");</code> then you have a sequence of strings, <code>d-&gt;text[0][0], d-&gt;text[1][0], </code>.... After <code><a class="el" href="structapop__data.html">apop_data</a> dt = apop_data_transpose(dataset)</code>, you will have a single list of strings, <code>dt-&gt;text[0]</code>, which is often useful as input to list-of-strings handling functions.</li>
</ul>
<ul>
<li><a class="el" href="group__all__public.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a> </li>
<li><a class="el" href="group__all__public.html#ga9fba0f07c262a433133f6f3362617da3">apop_text_alloc</a> : allocate or resize the text part of an <a class="el" href="gentle.html#apop_data">apop_data</a> set. </li>
<li><a class="el" href="group__all__public.html#gae987ac014cda5e483f8c16bfd59147ae">apop_text_set</a> : replace a single cell of the text grid with new text. </li>
<li><a class="el" href="group__all__public.html#ga6270ad55c566140e0d7962cb4d5daacc">apop_text_paste</a> : convert a table of strings into one long string. </li>
<li><a class="el" href="group__all__public.html#ga77c937ea4764d3da2ed9968273fa4544">apop_text_unique_elements</a> : get a sorted list of unique elements for one column of text. </li>
<li><a class="el" href="group__all__public.html#ga65386d7b37c2eaf37d1eb4e3ae7a7554">apop_text_free</a> : you may never need this, because <a class="el" href="group__all__public.html#ga459acfde11f2c39f5c32cff377f85b9e">apop_data_free</a> calls it. </li>
<li><a class="el" href="group__all__public.html#gaa9ec5e7ed223c09bec044ced54f24fad">apop_regex</a> : friendlier front-end for POSIX-standard regular expression searching and pulling matches into an <a class="el" href="gentle.html#apop_data">apop_data</a> set.</li>
</ul>
<h2><a class="anchor" id="fact"></a>
Generating factors</h2>
<p><em>Factor</em> is jargon for a numbered category. Number-crunching programs prefer integers over text, so we need a function to produce a one-to-one mapping from text categories into numeric factors.</p>
<p>A <em>dummy</em> is a variable that is either one or zero, depending on membership in a given group. Some methods (typically when the variable is an input or independent variable in a regression) prefer dummies; some methods (typically for outcome or dependent variables) prefer factors. The functions that generate factors and dummies will add an informational page to your <a class="el" href="gentle.html#apop_data">apop_data</a> set with a name like <code>&lt;categories for your_column&gt;</code> listing the conversion from the artificial numeric factor to the original data. Use <a class="el" href="group__all__public.html#gadec9170cf1382f6cd549a5819472eb51">apop_data_get_factor_names</a> to get a pointer to that page.</p>
<p>You can use the factor table to translate from numeric categories back to text (though you probably have the original text column in your data anyway).</p>
<p>Having the factor list in an auxiliary table makes it easy to ensure that multiple <a class="el" href="gentle.html#apop_data">apop_data</a> sets use the same single categorization scheme. Generate factors in the first set, then copy the factor list to the second, then run <a class="el" href="group__all__public.html#ga27405bd5fdf48d93c8918ca4c07ee260">apop_data_to_factors</a> on the second:</p>
<div class="fragment"><div class="line"><a class="code" href="group__all__public.html#ga27405bd5fdf48d93c8918ca4c07ee260">apop_data_to_factors</a>(d1);</div>
<div class="line">d2-&gt;more = <a class="code" href="group__all__public.html#gadd67e6838ce2521a1d756894dc9b5ccf">apop_data_copy</a>(<a class="code" href="group__all__public.html#gadec9170cf1382f6cd549a5819472eb51">apop_data_get_factor_names</a>(d1));</div>
<div class="line"><a class="code" href="group__all__public.html#ga27405bd5fdf48d93c8918ca4c07ee260">apop_data_to_factors</a>(d2);</div>
</div><!-- fragment --><ul>
<li><a class="el" href="group__all__public.html#gae0c28224e10f8aacdaa2d130f96f6ba2">apop_data_to_dummies</a> </li>
<li><a class="el" href="group__all__public.html#ga27405bd5fdf48d93c8918ca4c07ee260">apop_data_to_factors</a> </li>
<li><a class="el" href="group__all__public.html#gadec9170cf1382f6cd549a5819472eb51">apop_data_get_factor_names</a> </li>
<li><a class="el" href="group__all__public.html#ga77c937ea4764d3da2ed9968273fa4544">apop_text_unique_elements</a> </li>
<li><a class="el" href="group__all__public.html#ga6d68bacc086420a382366f9118cf5bc7">apop_vector_unique_elements</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
</body></html>

<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
     <title>Apophenia: a library for scientific computing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
     <link rel="stylesheet" href="typical.css" type="text/css" >
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!-- Google is watching. -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-134313-2";
urchinTracker();
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="typical.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<center><table cellpadding=10pt>
<tr> <td><img width=140px src=flake.gif alt="Patterns in static"></td>
<td><table>
    <tr> <td><center><h2><a href="http://apophenia.info">Apophenia</a></h2></center></td></tr>
    <tr><td><div class="qindex"> <a class="qindex" href="outline.html">Outline</a> | <a class="qindex" href="group__all__public.html">Index </a>  |         <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
                <!-- <a class="qindex" href="files.html">File&nbsp;List&nbsp;</a> -->  </div></td></tr></table>
                                  </td></tr></table></center>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('eg.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Some examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Here are a few pieces of sample code for testing your installation or to give you a sense of what code with Apophenia's tools looks like.</p>
<p><em> Two data streams</em></p>
<p>The sample program here is intended to show how one would integrate Apophenia into an existing program. For example, say that you are running a simulation of two different treatments, or say that two sensors are posting data at regular intervals. The goal is to gather the data in an organized form, and then ask questions of the resulting data set. Below, a thousand draws are made from the two processes and put into a database. Then, the data is pulled out, some simple statistics are compiled, and the data is written to a text file for inspection outside of the program. This program will compile cleanly with the sample <a class="el" href="makefile.html">Makefile</a>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;apop.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//Your processes are probably a bit more complex.</span></div>
<div class="line"><span class="keywordtype">double</span> process_one(gsl_rng *r){</div>
<div class="line">    <span class="keywordflow">return</span> gsl_rng_uniform(r) * gsl_rng_uniform(r) ;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> process_two(gsl_rng *r){</div>
<div class="line">    <span class="keywordflow">return</span> gsl_rng_uniform(r);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    gsl_rng *r = <a class="code" href="group__all__public.html#gada044cf02135422a9f9292b6054c86dd">apop_rng_alloc</a>(123);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//create the database and the data table.</span></div>
<div class="line">    <a class="code" href="group__all__public.html#ga4d81aff912df2982697038c51795e358">apop_db_open</a>(<span class="stringliteral">&quot;runs.db&quot;</span>);</div>
<div class="line">    <a class="code" href="group__all__public.html#ga01d501ca84ade92bc72fd4f67a617f64">apop_table_exists</a>(<span class="stringliteral">&quot;samples&quot;</span>, <span class="charliteral">&#39;d&#39;</span>); <span class="comment">//If the table already exists, delete it.</span></div>
<div class="line">    <a class="code" href="group__all__public.html#ga02cf6319da103f9bfe55dfbbc7675536">apop_query</a>(<span class="stringliteral">&quot;create table samples(iteration, process, value); begin;&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//populate the data table with runs.</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;1000; i++){</div>
<div class="line">        <span class="keywordtype">double</span> p1 = process_one(r);</div>
<div class="line">        <span class="keywordtype">double</span> p2 = process_two(r);</div>
<div class="line">        <a class="code" href="group__all__public.html#ga02cf6319da103f9bfe55dfbbc7675536">apop_query</a>(<span class="stringliteral">&quot;insert into samples values(%i, %i, %g);&quot;</span>, i, 1, p1);</div>
<div class="line">        <a class="code" href="group__all__public.html#ga02cf6319da103f9bfe55dfbbc7675536">apop_query</a>(<span class="stringliteral">&quot;insert into samples values(%i, %i, %g);&quot;</span>, i, 2, p2);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="group__all__public.html#ga02cf6319da103f9bfe55dfbbc7675536">apop_query</a>(<span class="stringliteral">&quot;commit;&quot;</span>); <span class="comment">//the begin-commit wrapper saves writes to the drive.</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//pull the data from the database, converting it into a table along the way. </span></div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *m  = <a class="code" href="group__all__public.html#gad22f12fdb3606b0bc49cd1929a05626e">apop_db_to_crosstab</a>(<span class="stringliteral">&quot;samples&quot;</span>, <span class="stringliteral">&quot;iteration&quot;</span>,<span class="stringliteral">&quot;process&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>);</div>
<div class="line"></div>
<div class="line">    gsl_vector *v1 = <a class="code" href="group__all__public.html#ga825321182fbaa7471069f13447170810">Apop_cv</a>(m, 0); <span class="comment">//get vector views of the two table columns.</span></div>
<div class="line">    gsl_vector *v2 = <a class="code" href="group__all__public.html#ga825321182fbaa7471069f13447170810">Apop_cv</a>(m, 1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Output a table of means/variances, and t-test results.</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;\t   mean\t\t   var\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;process 1: %f\t%f\n&quot;</span>, <a class="code" href="group__all__public.html#ga7b0289d499a3dfa51a0c6fc689505cb5">apop_mean</a>(v1), <a class="code" href="group__all__public.html#gae9308d562a120c8302edde3f736bc25d">apop_var</a>(v1));</div>
<div class="line">    printf(<span class="stringliteral">&quot;process 2: %f\t%f\n\n&quot;</span>, <a class="code" href="group__all__public.html#ga7b0289d499a3dfa51a0c6fc689505cb5">apop_mean</a>(v2), <a class="code" href="group__all__public.html#gae9308d562a120c8302edde3f736bc25d">apop_var</a>(v2));</div>
<div class="line">    printf(<span class="stringliteral">&quot;t test\n&quot;</span>);</div>
<div class="line">    apop_data_show(<a class="code" href="group__all__public.html#ga65c94b79fe91308dc97829741acc9322">apop_t_test</a>(v1, v2));</div>
<div class="line">    <a class="code" href="group__all__public.html#gab45a848e5dbcaf82b5b95cd03f7b396a">apop_data_print</a>(m, <span class="stringliteral">&quot;the_data.txt&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><em> Run a regression</em></p>
<p>See <a class="el" href="gentle.html">A quick overview</a> for an example of loading a data set and running a simple regression.</p>
<p><em> A sequence of t-tests</em></p>
<p>In <a class="el" href="dataoverview.html#mapply">The section on map/apply</a>, a new <img class="formulaInl" alt="$t$" src="form_45.png"/>-test on every row, with all operations acting on entire rows rather than individual data points:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;apop.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> row_offset;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> offset_rng(<span class="keywordtype">double</span> *v){*v = gsl_rng_uniform(<a class="code" href="group__all__public.html#ga1e829ce2396bf05ab10460bcc37aeeab">apop_rng_get_thread</a>()) + row_offset;}</div>
<div class="line"><span class="keywordtype">double</span> find_tstat(gsl_vector *in){ <span class="keywordflow">return</span> <a class="code" href="group__all__public.html#ga7b0289d499a3dfa51a0c6fc689505cb5">apop_mean</a>(in)/sqrt(<a class="code" href="group__all__public.html#gae9308d562a120c8302edde3f736bc25d">apop_var</a>(in));}</div>
<div class="line"><span class="keywordtype">double</span> conf(<span class="keywordtype">double</span> in, <span class="keywordtype">void</span> *df){ <span class="keywordflow">return</span> gsl_cdf_tdist_P(in, *(<span class="keywordtype">int</span> *)df);}</div>
<div class="line"></div>
<div class="line"><span class="comment">//apop_vector_mean is a macro, so we can&#39;t point a pointer to it.</span></div>
<div class="line"><span class="keywordtype">double</span> mu(gsl_vector *in){ <span class="keywordflow">return</span> <a class="code" href="group__all__public.html#gab20e5ad95df0f24a1ea06294695031a8">apop_vector_mean</a>(in);}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *d = <a class="code" href="group__all__public.html#gac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(10, 100);</div>
<div class="line">    gsl_rng *r = <a class="code" href="group__all__public.html#gada044cf02135422a9f9292b6054c86dd">apop_rng_alloc</a>(3242);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; 10; i++){</div>
<div class="line">        row_offset = gsl_rng_uniform(r)*2 -1; <span class="comment">//declared and used above.</span></div>
<div class="line">        <a class="code" href="group__all__public.html#ga51964750c64d327e52e2230019e44f66">apop_vector_apply</a>(<a class="code" href="group__all__public.html#ga314f28de914dfe6e45170e09d71d5429">Apop_rv</a>(d, i), offset_rng);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">size_t</span> df = d-&gt;matrix-&gt;size2-1;</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *means = <a class="code" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(d, .fn_v = mu, .part =<span class="charliteral">&#39;r&#39;</span>);</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *tstats = <a class="code" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(d, .fn_v = find_tstat, .part =<span class="charliteral">&#39;r&#39;</span>);</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *confidences = <a class="code" href="group__all__public.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(tstats, .fn_dp = conf, .param = &amp;df);</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;means:\n&quot;</span>); apop_data_show(means);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nt stats:\n&quot;</span>); apop_data_show(tstats);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nconfidences:\n&quot;</span>); apop_data_show(confidences);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Some sanity checks, for Apophenia&#39;s test suite.</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; 10; i++){</div>
<div class="line">        <span class="comment">//sign of mean == sign of t stat.</span></div>
<div class="line">        assert(<a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(means, i, -1) * <a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(tstats, i, -1) &gt;=0);</div>
<div class="line"></div>
<div class="line">        <span class="comment">//inverse of P-value should be the t statistic.</span></div>
<div class="line">        assert(fabs(gsl_cdf_tdist_Pinv(<a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(confidences, i, -1),100) </div>
<div class="line">                    - <a class="code" href="group__all__public.html#ga06107779e4a3eb229715ceca24352b89">apop_data_get</a>(tstats, i, -1) &lt; 1e-3));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>In the documentation for <a class="el" href="group__all__public.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a>, a program to list all the tables in an SQLite database. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;apop.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> print_table_list(<span class="keywordtype">char</span> *db_file){</div>
<div class="line">    <a class="code" href="group__all__public.html#ga4d81aff912df2982697038c51795e358">apop_db_open</a>(db_file);</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *tab_list= <a class="code" href="group__all__public.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a>(<span class="stringliteral">&quot;select name &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;from sqlite_master where type==&#39;table&#39;&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; tab_list-&gt;textsize[0]; i++)</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s\n&quot;</span>, tab_list-&gt;text[i][0]);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv){</div>
<div class="line">    <span class="keywordflow">if</span> (argc == 1){</div>
<div class="line">        printf(<span class="stringliteral">&quot;Give me a database name, and I will print out &quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;the list of tables contained therein.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0; </div>
<div class="line">    }</div>
<div class="line">    print_table_list(argv[1]);</div>
<div class="line">}</div>
</div><!-- fragment --><p><em>Marginal distribution</em></p>
<p>A demonstration of fixing parameters to create a marginal distribution, via <a class="el" href="group__all__public.html#gab4f6ca7e042ac7c09c3c01d29702a739">apop_model_fix_params</a> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;apop.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <span class="keywordtype">size_t</span> ct = 5e4;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//set up the model &amp; params</span></div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *params = <a class="code" href="group__all__public.html#gacb6b2c53478f9db902ba0340ba499819">apop_data_falloc</a>((2,2,2), 8,  1, 0.5,</div>
<div class="line">                                                  2,  0.5, 1);</div>
<div class="line">    <a class="code" href="structapop__model.html">apop_model</a> *pvm = <a class="code" href="group__all__public.html#ga87d3a65f43071b9d61d9edd59249c629">apop_model_copy</a>(<a class="code" href="group__models.html#ga3a4389e6e2a1a2ea606f89d55ec558d3">apop_multivariate_normal</a>);</div>
<div class="line">    pvm-&gt;parameters = <a class="code" href="group__all__public.html#gadd67e6838ce2521a1d756894dc9b5ccf">apop_data_copy</a>(params);</div>
<div class="line">    pvm-&gt;dsize = 2;</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *d = <a class="code" href="group__all__public.html#ga4e204cdc7429bef3ca2efb83453fe77a">apop_model_draws</a>(pvm, ct);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//set up and estimate a model with fixed covariance matrix but free means</span></div>
<div class="line">    gsl_vector_set_all(pvm-&gt;parameters-&gt;vector, GSL_NAN);</div>
<div class="line">    <a class="code" href="structapop__model.html">apop_model</a> *mep1 = <a class="code" href="group__all__public.html#gab4f6ca7e042ac7c09c3c01d29702a739">apop_model_fix_params</a>(pvm);</div>
<div class="line">    <a class="code" href="structapop__model.html">apop_model</a> *e1 = <a class="code" href="group__all__public.html#ga2c0598e5aca68949939a189bd4ce24ca">apop_estimate</a>(d, mep1);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//compare results</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;original params: &quot;</span>);</div>
<div class="line">    <a class="code" href="group__all__public.html#ga6e68deb42339cf6068ab6e741237918d">apop_vector_print</a>(params-&gt;vector);</div>
<div class="line">    printf(<span class="stringliteral">&quot;estimated params: &quot;</span>);</div>
<div class="line">    <a class="code" href="group__all__public.html#ga6e68deb42339cf6068ab6e741237918d">apop_vector_print</a>(e1-&gt;parameters-&gt;vector);</div>
<div class="line">    assert(<a class="code" href="group__all__public.html#ga44a77f5e6867c627fd313f3f6e252ff8">apop_vector_distance</a>(params-&gt;vector, e1-&gt;parameters-&gt;vector)&lt;1e-2); </div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
</body></html>
